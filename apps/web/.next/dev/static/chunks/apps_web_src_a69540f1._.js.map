{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/hooks/useFamily.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useCallback, useState, useMemo } from 'react';\nimport { useFamilyStore, type Family, type FamilyMember } from '@/stores/familyStore';\nimport { useAuthStore } from '@/stores/authStore';\nimport { createClient } from '@/lib/supabase';\nimport type { FamilyRole } from '@kintree/shared';\n\nexport interface CreateFamilyInput {\n  name: string;\n  description?: string;\n  primaryColor?: string;\n}\n\nexport function useFamily() {\n  const user = useAuthStore((state) => state.user);\n  const supabase = useMemo(() => createClient(), []);\n  const {\n    currentFamily,\n    families,\n    members,\n    currentUserRole,\n    isLoading,\n    setCurrentFamily,\n    setFamilies,\n    setMembers,\n    setCurrentUserRole,\n    setLoading,\n    reset,\n  } = useFamilyStore();\n\n  const [error, setError] = useState<string | null>(null);\n\n  // Fetch user's families on mount\n  useEffect(() => {\n    if (user?.id) {\n      fetchFamilies();\n    } else {\n      reset();\n    }\n  }, [user?.id]);\n\n  // Fetch family members when current family changes\n  useEffect(() => {\n    if (currentFamily?.id && user?.id) {\n      fetchMembers(currentFamily.id);\n      fetchUserRole(currentFamily.id);\n    }\n  }, [currentFamily?.id, user?.id]);\n\n  const fetchFamilies = useCallback(async () => {\n    if (!user?.id) return;\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      // Get families where user is a member\n      const { data: memberData, error: memberError } = await supabase\n        .from('family_members')\n        .select(`\n          family_id,\n          role,\n          families (\n            id,\n            name,\n            description,\n            primary_color,\n            created_at\n          )\n        `)\n        .eq('user_id', user.id)\n        .eq('is_active', true);\n\n      if (memberError) throw memberError;\n\n      const familyList: Family[] = (memberData || [])\n        .filter((m: any) => m.families)\n        .map((m: any) => ({\n          id: (m.families as any).id,\n          name: (m.families as any).name,\n          description: (m.families as any).description,\n          primaryColor: (m.families as any).primary_color || '#0ea5e9',\n          createdAt: (m.families as any).created_at,\n          memberCount: 0, // Will be updated later\n        }));\n\n      setFamilies(familyList);\n\n      // Auto-select first family if none selected\n      if (familyList.length > 0 && !currentFamily) {\n        setCurrentFamily(familyList[0]);\n      }\n    } catch (err) {\n      console.error('Error fetching families:', err);\n      setError('Error loading families');\n    } finally {\n      setLoading(false);\n    }\n  }, [user?.id, currentFamily, setFamilies, setCurrentFamily, setLoading]);\n\n  const fetchMembers = useCallback(async (familyId: string) => {\n    try {\n      const { data, error } = await supabase\n        .from('family_members')\n        .select(`\n          id,\n          user_id,\n          person_id,\n          role,\n          accepted_at,\n          is_active\n        `)\n        .eq('family_id', familyId)\n        .eq('is_active', true);\n\n      if (error) throw error;\n\n      // Fetch user profiles separately to avoid join issues\n      const userIds = (data || []).map((m: any) => m.user_id);\n      let profilesMap: Record<string, any> = {};\n\n      if (userIds.length > 0) {\n        const { data: profiles } = await supabase\n          .from('user_profiles')\n          .select('id, email, first_name, last_name, avatar_url')\n          .in('id', userIds);\n\n        if (profiles) {\n          profilesMap = profiles.reduce((acc: any, p: any) => {\n            acc[p.id] = p;\n            return acc;\n          }, {});\n        }\n      }\n\n      const memberList: FamilyMember[] = (data || []).map((m: any) => {\n        const profile = profilesMap[m.user_id] || {};\n        return {\n          id: m.id,\n          userId: m.user_id,\n          personId: m.person_id || undefined,\n          role: m.role as FamilyRole,\n          email: profile.email || '',\n          displayName: `${profile.first_name || ''} ${profile.last_name || ''}`.trim() || 'User',\n          avatarUrl: profile.avatar_url,\n          joinedAt: m.accepted_at || '',\n          isActive: m.is_active,\n        };\n      });\n\n      setMembers(memberList);\n\n      // Update member count in current family\n      if (currentFamily) {\n        setCurrentFamily({ ...currentFamily, memberCount: memberList.length });\n      }\n    } catch (err) {\n      console.error('Error fetching members:', err);\n      setMembers([]);\n    }\n  }, [currentFamily, setMembers, setCurrentFamily]);\n\n  const fetchUserRole = useCallback(async (familyId: string) => {\n    if (!user?.id) return;\n\n    try {\n      const { data, error } = await supabase\n        .from('family_members')\n        .select('role')\n        .eq('family_id', familyId)\n        .eq('user_id', user.id)\n        .eq('is_active', true)\n        .maybeSingle();\n\n      if (error) throw error;\n\n      // data will be null if no record found, which is valid\n      setCurrentUserRole(data?.role as FamilyRole || null);\n    } catch (err) {\n      console.error('Error fetching user role:', err);\n      setCurrentUserRole(null);\n    }\n  }, [user?.id, setCurrentUserRole]);\n\n  const createFamily = useCallback(async (input: CreateFamilyInput): Promise<Family | null> => {\n    if (!user?.id) return null;\n\n    setError(null);\n\n    try {\n      const { data, error } = await supabase\n        .from('families')\n        .insert({\n          name: input.name,\n          description: input.description,\n          primary_color: input.primaryColor || '#0ea5e9',\n          created_by: user.id,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      const newFamily: Family = {\n        id: data.id,\n        name: data.name,\n        description: data.description,\n        primaryColor: data.primary_color,\n        createdAt: data.created_at,\n        memberCount: 1,\n      };\n\n      // Refresh families list\n      await fetchFamilies();\n\n      // Set as current family\n      setCurrentFamily(newFamily);\n\n      return newFamily;\n    } catch (err) {\n      console.error('Error creating family:', err);\n      setError('Error creating family');\n      return null;\n    }\n  }, [user?.id, fetchFamilies, setCurrentFamily]);\n\n  const inviteMember = useCallback(async (email: string, role: FamilyRole = 'viewer'): Promise<boolean> => {\n    if (!currentFamily?.id || !user?.id) return false;\n\n    setError(null);\n\n    try {\n      // First, find the user by email\n      const { data: userData, error: userError } = await supabase\n        .from('user_profiles')\n        .select('id')\n        .eq('email', email)\n        .single();\n\n      if (userError || !userData) {\n        setError('User not found with that email');\n        return false;\n      }\n\n      // Add them as a family member\n      const { error: memberError } = await supabase\n        .from('family_members')\n        .insert({\n          family_id: currentFamily.id,\n          user_id: userData.id,\n          role,\n          invited_by: user.id,\n        });\n\n      if (memberError) {\n        if (memberError.code === '23505') {\n          setError('User is already a member of this family');\n        } else {\n          throw memberError;\n        }\n        return false;\n      }\n\n      // Refresh members\n      await fetchMembers(currentFamily.id);\n\n      return true;\n    } catch (err) {\n      console.error('Error inviting member:', err);\n      setError('Error inviting member');\n      return false;\n    }\n  }, [currentFamily?.id, user?.id, fetchMembers]);\n\n  const updateMemberRole = useCallback(async (memberId: string, newRole: FamilyRole): Promise<boolean> => {\n    if (!currentFamily?.id) return false;\n\n    try {\n      const { error } = await supabase\n        .from('family_members')\n        .update({ role: newRole })\n        .eq('id', memberId);\n\n      if (error) throw error;\n\n      await fetchMembers(currentFamily.id);\n      return true;\n    } catch (err) {\n      console.error('Error updating member role:', err);\n      return false;\n    }\n  }, [currentFamily?.id, fetchMembers]);\n\n  const removeMember = useCallback(async (memberId: string): Promise<boolean> => {\n    if (!currentFamily?.id) return false;\n\n    try {\n      const { error } = await supabase\n        .from('family_members')\n        .update({ is_active: false })\n        .eq('id', memberId);\n\n      if (error) throw error;\n\n      await fetchMembers(currentFamily.id);\n      return true;\n    } catch (err) {\n      console.error('Error removing member:', err);\n      return false;\n    }\n  }, [currentFamily?.id, fetchMembers]);\n\n  const switchFamily = useCallback((familyId: string) => {\n    const family = families.find((f) => f.id === familyId);\n    if (family) {\n      setCurrentFamily(family);\n    }\n  }, [families, setCurrentFamily]);\n\n  const canEdit = currentUserRole === 'admin' || currentUserRole === 'editor';\n  const isAdmin = currentUserRole === 'admin';\n\n  return {\n    currentFamily,\n    families,\n    members,\n    currentUserRole,\n    isLoading,\n    error,\n    canEdit,\n    isAdmin,\n    fetchFamilies,\n    createFamily,\n    inviteMember,\n    updateMemberRole,\n    removeMember,\n    switchFamily,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 340, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/app/%28dashboard%29/invitations/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport {\n  Skeleton,\n  Avatar,\n  Badge,\n} from '@kintree/ui';\nimport { useFamilyInvitations } from '@/hooks/useFamilyInvitations';\nimport { useFamily } from '@/hooks/useFamily';\nimport { useFamilyStore } from '@/stores/familyStore';\n\nexport default function InvitationsPage() {\n  const router = useRouter();\n  const {\n    sentInvitations,\n    receivedInvitations,\n    isLoading,\n    acceptInvitation,\n    rejectInvitation,\n    cancelInvitation,\n    resendInvitation,\n  } = useFamilyInvitations();\n  const { fetchFamilies } = useFamily();\n  const setCurrentFamily = useFamilyStore((state) => state.setCurrentFamily);\n\n  const [processingId, setProcessingId] = useState<string | null>(null);\n\n  const handleAccept = async (invitationId: string) => {\n    const invitation = receivedInvitations.find(inv => inv.id === invitationId);\n    if (!invitation) return;\n\n    setProcessingId(invitationId);\n    try {\n      const result = await acceptInvitation(invitationId);\n\n      if (result.success && result.familyId) {\n        setCurrentFamily({\n          id: result.familyId,\n          name: invitation.familyName || 'My Family',\n          primaryColor: '#ff6b47',\n          createdAt: new Date().toISOString(),\n          memberCount: 1,\n        });\n        await fetchFamilies();\n        setProcessingId(null);\n        await new Promise(resolve => setTimeout(resolve, 300));\n        router.push('/tree');\n      } else {\n        setProcessingId(null);\n        alert(result.error || 'Error accepting invitation');\n      }\n    } catch (error) {\n      console.error('Error accepting invitation:', error);\n      setProcessingId(null);\n      alert('Unexpected error accepting invitation');\n    }\n  };\n\n  const handleReject = async (invitationId: string) => {\n    setProcessingId(invitationId);\n    await rejectInvitation(invitationId);\n    setProcessingId(null);\n  };\n\n  const handleCancel = async (invitationId: string) => {\n    setProcessingId(invitationId);\n    await cancelInvitation(invitationId);\n    setProcessingId(null);\n  };\n\n  const handleResend = async (invitationId: string) => {\n    setProcessingId(invitationId);\n    await resendInvitation(invitationId);\n    setProcessingId(null);\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n    });\n  };\n\n  const isExpired = (expiresAt: string) => {\n    return new Date(expiresAt) < new Date();\n  };\n\n  if (isLoading) {\n    return <InvitationsSkeleton />;\n  }\n\n  return (\n    <div className=\"max-w-3xl mx-auto px-4 pt-8 pb-24\">\n      <div className=\"mb-10 animate-fade-in\">\n        <h1 className=\"text-3xl font-bold text-neutral-900 tracking-tight\">Invitations</h1>\n        <p className=\"text-neutral-500 mt-2 text-lg\">\n          Manage your family connections\n        </p>\n      </div>\n\n      <div className=\"space-y-8 animate-slide-up\">\n        {/* Received Invitations */}\n        <div className=\"bg-white p-6 rounded-3xl border border-neutral-100 shadow-sm\">\n          <h2 className=\"text-lg font-bold text-neutral-900 mb-6 flex items-center gap-2\">\n            <InboxIcon className=\"w-5 h-5 text-neutral-400\" />\n            Received\n            {receivedInvitations.length > 0 &&\n              <span className=\"ml-2 bg-red-100 text-red-600 text-xs font-bold px-2 py-0.5 rounded-full\">{receivedInvitations.length}</span>\n            }\n          </h2>\n\n          {receivedInvitations.length === 0 ? (\n            <div className=\"text-center py-12 bg-neutral-50 rounded-2xl border border-dashed border-neutral-200\">\n              <MailIcon className=\"w-10 h-10 text-neutral-300 mx-auto mb-3\" />\n              <p className=\"text-neutral-500 font-medium\">No pending invitations</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {receivedInvitations.map((invitation) => (\n                <div key={invitation.id} className=\"p-5 rounded-2xl border border-neutral-200 hover:border-neutral-300 transition-colors bg-neutral-50/50\">\n                  <div className=\"flex flex-col sm:flex-row gap-4\">\n                    <div className=\"flex items-center gap-4 flex-1\">\n                      <div className=\"w-12 h-12 rounded-full bg-neutral-900 flex items-center justify-center text-white shrink-0\">\n                        <UsersIcon className=\"w-5 h-5\" />\n                      </div>\n                      <div>\n                        <p className=\"font-bold text-neutral-900 text-lg\">\n                          {invitation.inviterName || 'Someone'} invited you\n                        </p>\n                        <p className=\"text-neutral-600\">\n                          Join <strong>{invitation.familyName}</strong> as <strong>{invitation.personName}</strong>\n                        </p>\n                        <p className=\"text-xs text-neutral-400 mt-1\">\n                          Sent on {formatDate(invitation.createdAt)}\n                        </p>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-2 self-end sm:self-center w-full sm:w-auto\">\n                      {isExpired(invitation.expiresAt) ? (\n                        <span className=\"px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-bold\">Expired</span>\n                      ) : (\n                        <>\n                          <button\n                            onClick={() => handleReject(invitation.id)}\n                            disabled={processingId === invitation.id}\n                            className=\"flex-1 sm:flex-none px-4 py-2 rounded-xl text-neutral-600 font-medium hover:bg-neutral-200 transition-colors text-sm\"\n                          >\n                            Reject\n                          </button>\n                          <button\n                            onClick={() => handleAccept(invitation.id)}\n                            disabled={processingId === invitation.id}\n                            className=\"flex-1 sm:flex-none px-6 py-2 rounded-xl bg-neutral-900 text-white font-bold hover:bg-neutral-800 transition-colors text-sm flex items-center justify-center gap-2\"\n                          >\n                            {processingId === invitation.id && <Spinner className=\"w-4 h-4\" />}\n                            Accept\n                          </button>\n                        </>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Sent Invitations */}\n        <div className=\"bg-white p-6 rounded-3xl border border-neutral-100 shadow-sm\">\n          <h2 className=\"text-lg font-bold text-neutral-900 mb-6 flex items-center gap-2\">\n            <SendIcon className=\"w-5 h-5 text-neutral-400\" />\n            Sent\n            {sentInvitations.length > 0 &&\n              <span className=\"ml-2 bg-neutral-100 text-neutral-600 text-xs font-bold px-2 py-0.5 rounded-full\">{sentInvitations.length}</span>\n            }\n          </h2>\n\n          {sentInvitations.length === 0 ? (\n            <div className=\"text-center py-12 bg-neutral-50 rounded-2xl border border-dashed border-neutral-200\">\n              <SendIcon className=\"w-10 h-10 text-neutral-300 mx-auto mb-3\" />\n              <p className=\"text-neutral-500 font-medium\">No invitations sent yet</p>\n              <button onClick={() => router.push('/tree')} className=\"mt-4 text-neutral-900 font-bold underline hover:text-neutral-700\">\n                Go to Tree to invite family\n              </button>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {sentInvitations.map((invitation) => {\n                const expired = isExpired(invitation.expiresAt);\n                return (\n                  <div key={invitation.id} className=\"p-4 rounded-2xl border border-neutral-100 hover:border-neutral-200 transition-colors flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar name={invitation.personName || invitation.inviteeEmail} size=\"md\" />\n                      <div>\n                        <p className=\"font-bold text-neutral-900 text-sm\">\n                          {invitation.personName || 'Relative'}\n                        </p>\n                        <p className=\"text-xs text-neutral-500\">{invitation.inviteeEmail}</p>\n                      </div>\n                    </div>\n\n                    <div className=\"flex items-center gap-3\">\n                      <InvitationStatusBadge status={invitation.status} expired={expired} />\n\n                      {invitation.status === 'pending' && (\n                        expired ? (\n                          <button\n                            onClick={() => handleResend(invitation.id)}\n                            disabled={processingId === invitation.id}\n                            className=\"text-xs font-bold text-neutral-900 hover:text-neutral-600\"\n                          >\n                            Resend\n                          </button>\n                        ) : (\n                          <button\n                            onClick={() => handleCancel(invitation.id)}\n                            disabled={processingId === invitation.id}\n                            className=\"text-xs font-bold text-red-600 hover:text-red-400\"\n                          >\n                            Cancel\n                          </button>\n                        )\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction InvitationStatusBadge({ status, expired }: { status: string; expired: boolean }) {\n  if (status === 'accepted') return <span className=\"bg-green-100 text-green-700 px-2.5 py-1 rounded-full text-xs font-bold\">Accepted</span>;\n  if (status === 'rejected') return <span className=\"bg-red-100 text-red-700 px-2.5 py-1 rounded-full text-xs font-bold\">Rejected</span>;\n  if (expired) return <span className=\"bg-amber-100 text-amber-700 px-2.5 py-1 rounded-full text-xs font-bold\">Expired</span>;\n  return <span className=\"bg-neutral-100 text-neutral-600 px-2.5 py-1 rounded-full text-xs font-bold\">Pending</span>;\n}\n\nfunction InvitationsSkeleton() {\n  return (\n    <div className=\"max-w-3xl mx-auto px-4 pt-8\">\n      <Skeleton width={200} height={40} className=\"mb-10\" />\n      <Skeleton height={200} className=\"rounded-3xl mb-8\" />\n      <Skeleton height={200} className=\"rounded-3xl\" />\n    </div>\n  );\n}\n\n// Icons\nfunction MailIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className || \"w-6 h-6\"} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" />\n      <path d=\"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7\" />\n    </svg>\n  );\n}\n\nfunction InboxIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <polyline points=\"22 12 16 12 14 15 10 15 8 12 2 12\" />\n      <path d=\"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z\" />\n    </svg>\n  );\n}\n\nfunction SendIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className || \"w-6 h-6\"} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\" />\n      <polygon points=\"22 2 15 22 11 13 2 9 22 2\" />\n    </svg>\n  );\n}\n\nfunction UsersIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className || \"w-6 h-6\"} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n      <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\" />\n      <circle cx=\"9\" cy=\"7\" r=\"4\" />\n      <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\" />\n      <path d=\"M16 3.13a4 4 0 0 1 0 7.75\" />\n    </svg>\n  );\n}\n\nfunction Spinner({ className }: { className?: string }) {\n  return (\n    <svg className={`animate-spin ${className}`} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\">\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n    </svg>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}