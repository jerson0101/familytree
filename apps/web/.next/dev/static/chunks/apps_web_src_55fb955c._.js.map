{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/hooks/useFamilyTree.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useCallback, useState, useMemo } from 'react';\nimport { useFamilyStore } from '@/stores/familyStore';\nimport { createClient } from '@/lib/supabase';\nimport type { GraphData, GraphPerson, GraphUnion, GraphRelationship } from '@kintree/graph-engine';\nimport type { Gender } from '@kintree/shared';\n\nexport interface Person {\n  id: string;\n  familyId: string;\n  firstName: string;\n  middleNames?: string[];\n  lastName?: string;\n  maidenName?: string;\n  nicknames?: string[];\n  birthDate?: string;\n  birthDateApproximate?: boolean;\n  birthPlace?: string;\n  deathDate?: string;\n  deathDateApproximate?: boolean;\n  deathPlace?: string;\n  gender: Gender;\n  isLiving: boolean;\n  biography?: string;\n  photoUrl?: string;\n  medicalConditions?: any[];\n  linkedUserId?: string;\n  createdAt: string;\n}\n\nexport interface Union {\n  id: string;\n  familyId: string;\n  partner1Id: string;\n  partner2Id?: string;\n  unionType: string;\n  startDate?: string;\n  endDate?: string;\n  location?: string;\n  children: string[];\n}\n\nexport interface Relationship {\n  id: string;\n  familyId: string;\n  person1Id: string;\n  person2Id: string;\n  relationshipType: string;\n  isBiological: boolean;\n}\n\nexport interface MedicalCondition {\n  id: string;\n  name: string;\n  severity?: 'mild' | 'moderate' | 'severe';\n  diagnosed?: string; // Date of diagnosis\n  notes?: string;\n}\n\nexport interface CreatePersonInput {\n  firstName: string;\n  lastName?: string;\n  gender: Gender;\n  birthDate?: string;\n  isLiving?: boolean;\n  photoUrl?: string;\n  medicalConditions?: MedicalCondition[];\n}\n\nexport type RelationshipTypeOption =\n  | 'self'           // Root person (me)\n  | 'father'\n  | 'mother'\n  | 'spouse'\n  | 'son'\n  | 'daughter'\n  | 'brother'\n  | 'sister'\n  | 'grandfather_paternal'\n  | 'grandmother_paternal'\n  | 'grandfather_maternal'\n  | 'grandmother_maternal'\n  | 'uncle'\n  | 'aunt'\n  | 'cousin';\n\nexport interface CreatePersonWithRelationshipInput extends CreatePersonInput {\n  relationshipType: RelationshipTypeOption;\n  relatedToPersonId?: string; // The person this new person is related to\n}\n\nexport function useFamilyTree() {\n  const currentFamily = useFamilyStore((state) => state.currentFamily);\n  const supabase = useMemo(() => createClient(), []);\n  const [persons, setPersons] = useState<Person[]>([]);\n  const [unions, setUnions] = useState<Union[]>([]);\n  const [relationships, setRelationships] = useState<Relationship[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Fetch all data when family changes\n  useEffect(() => {\n    if (currentFamily?.id) {\n      fetchTreeData(currentFamily.id);\n    } else {\n      setPersons([]);\n      setUnions([]);\n      setRelationships([]);\n      setIsLoading(false);\n    }\n  }, [currentFamily?.id]);\n\n  const fetchTreeData = useCallback(async (familyId: string) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // Fetch persons\n      const { data: personsData, error: personsError } = await supabase\n        .from('persons')\n        .select('*')\n        .eq('family_id', familyId)\n        .order('created_at', { ascending: true });\n\n      if (personsError) throw personsError;\n\n      // Fetch unions\n      const { data: unionsData, error: unionsError } = await supabase\n        .from('unions')\n        .select('*')\n        .eq('family_id', familyId);\n\n      if (unionsError) throw unionsError;\n\n      // Fetch union children\n      const { data: childrenData, error: childrenError } = await supabase\n        .from('union_children')\n        .select('union_id, child_id')\n        .in('union_id', (unionsData || []).map((u: any) => u.id));\n\n      if (childrenError) throw childrenError;\n\n      // Fetch relationships\n      const { data: relationshipsData, error: relError } = await supabase\n        .from('relationships')\n        .select('*')\n        .eq('family_id', familyId);\n\n      if (relError) throw relError;\n\n      // Map data\n      const personsList: Person[] = (personsData || []).map((p: any) => ({\n        id: p.id,\n        familyId: p.family_id,\n        firstName: p.first_name,\n        middleNames: p.middle_names,\n        lastName: p.last_name,\n        maidenName: p.maiden_name,\n        nicknames: p.nicknames,\n        birthDate: p.birth_date,\n        birthDateApproximate: p.birth_date_approximate,\n        birthPlace: p.birth_place,\n        deathDate: p.death_date,\n        deathDateApproximate: p.death_date_approximate,\n        deathPlace: p.death_place,\n        gender: p.gender as Gender,\n        isLiving: p.is_living,\n        biography: p.biography,\n        photoUrl: p.photo_url,\n        medicalConditions: p.medical_conditions,\n        linkedUserId: p.linked_user_id,\n        createdAt: p.created_at,\n      }));\n\n      // Group children by union\n      const childrenByUnion = new Map<string, string[]>();\n      (childrenData || []).forEach((c: any) => {\n        const existing = childrenByUnion.get(c.union_id) || [];\n        existing.push(c.child_id);\n        childrenByUnion.set(c.union_id, existing);\n      });\n\n      const unionsList: Union[] = (unionsData || []).map((u: any) => ({\n        id: u.id,\n        familyId: u.family_id,\n        partner1Id: u.partner1_id,\n        partner2Id: u.partner2_id,\n        unionType: u.union_type,\n        startDate: u.start_date,\n        endDate: u.end_date,\n        location: u.location,\n        children: childrenByUnion.get(u.id) || [],\n      }));\n\n      const relationshipsList: Relationship[] = (relationshipsData || []).map((r: any) => ({\n        id: r.id,\n        familyId: r.family_id,\n        person1Id: r.person1_id,\n        person2Id: r.person2_id,\n        relationshipType: r.relationship_type,\n        isBiological: r.is_biological,\n      }));\n\n      setPersons(personsList);\n      setUnions(unionsList);\n      setRelationships(relationshipsList);\n    } catch (err) {\n      console.error('Error fetching tree data:', err);\n      setError('Error loading family tree');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Convert to GraphData format for the layout engine\n  const graphData: GraphData = useMemo(() => {\n    const graphPersons: GraphPerson[] = persons.map(p => ({\n      id: p.id,\n      firstName: p.firstName,\n      lastName: p.lastName || '',\n      gender: p.gender,\n      birthDate: p.birthDate,\n      birthDateApproximate: p.birthDateApproximate,\n      deathDate: p.deathDate,\n      deathDateApproximate: p.deathDateApproximate,\n      photoUrl: p.photoUrl,\n      isLiving: p.isLiving,\n      medicalConditions: p.medicalConditions,\n    }));\n\n    const graphUnions: GraphUnion[] = unions.map(u => ({\n      id: u.id,\n      partner1Id: u.partner1Id,\n      partner2Id: u.partner2Id || '',\n      unionType: u.unionType as any,\n      startDate: u.startDate,\n      endDate: u.endDate,\n      childrenIds: u.children,\n    }));\n\n    const graphRelationships: GraphRelationship[] = relationships.map(r => ({\n      id: r.id,\n      personId: r.person1Id,\n      relatedPersonId: r.person2Id,\n      type: r.relationshipType === 'parent_child' ? 'parent' : r.relationshipType as any,\n    }));\n\n    return {\n      persons: graphPersons,\n      unions: graphUnions,\n      relationships: graphRelationships,\n    };\n  }, [persons, unions, relationships]);\n\n  // CRUD operations\n  const createPerson = useCallback(async (input: CreatePersonInput): Promise<Person | null> => {\n    if (!currentFamily?.id) return null;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    try {\n      const { data, error } = await supabase\n        .from('persons')\n        .insert({\n          family_id: currentFamily.id,\n          first_name: input.firstName,\n          last_name: input.lastName,\n          gender: input.gender,\n          birth_date: input.birthDate,\n          is_living: input.isLiving ?? true,\n          photo_url: input.photoUrl,\n          created_by: userData.user.id,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      const newPerson: Person = {\n        id: data.id,\n        familyId: data.family_id,\n        firstName: data.first_name,\n        lastName: data.last_name,\n        gender: data.gender as Gender,\n        birthDate: data.birth_date,\n        isLiving: data.is_living,\n        photoUrl: data.photo_url,\n        createdAt: data.created_at,\n      };\n\n      setPersons(prev => [...prev, newPerson]);\n      return newPerson;\n    } catch (err) {\n      console.error('Error creating person:', err);\n      setError('Error creating person');\n      return null;\n    }\n  }, [currentFamily?.id]);\n\n  const updatePerson = useCallback(async (personId: string, updates: Partial<CreatePersonInput>): Promise<boolean> => {\n    try {\n      const updateData: Record<string, any> = {};\n      if (updates.firstName !== undefined) updateData.first_name = updates.firstName;\n      if (updates.lastName !== undefined) updateData.last_name = updates.lastName;\n      if (updates.gender !== undefined) updateData.gender = updates.gender;\n      if (updates.birthDate !== undefined) updateData.birth_date = updates.birthDate;\n      if (updates.isLiving !== undefined) updateData.is_living = updates.isLiving;\n      if (updates.photoUrl !== undefined) updateData.photo_url = updates.photoUrl;\n\n      const { error } = await supabase\n        .from('persons')\n        .update(updateData)\n        .eq('id', personId);\n\n      if (error) throw error;\n\n      // Refresh data\n      if (currentFamily?.id) {\n        await fetchTreeData(currentFamily.id);\n      }\n\n      return true;\n    } catch (err) {\n      console.error('Error updating person:', err);\n      return false;\n    }\n  }, [currentFamily?.id, fetchTreeData]);\n\n  const deletePerson = useCallback(async (personId: string): Promise<boolean> => {\n    try {\n      const { error } = await supabase\n        .from('persons')\n        .delete()\n        .eq('id', personId);\n\n      if (error) throw error;\n\n      setPersons(prev => prev.filter(p => p.id !== personId));\n      return true;\n    } catch (err) {\n      console.error('Error deleting person:', err);\n      return false;\n    }\n  }, []);\n\n  const createUnion = useCallback(async (\n    partner1Id: string,\n    partner2Id: string | null,\n    type: string = 'marriage'\n  ): Promise<Union | null> => {\n    if (!currentFamily?.id) return null;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    try {\n      const { data, error } = await supabase\n        .from('unions')\n        .insert({\n          family_id: currentFamily.id,\n          partner1_id: partner1Id,\n          partner2_id: partner2Id,\n          union_type: type,\n          created_by: userData.user.id,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      const newUnion: Union = {\n        id: data.id,\n        familyId: data.family_id,\n        partner1Id: data.partner1_id,\n        partner2Id: data.partner2_id,\n        unionType: data.union_type,\n        startDate: data.start_date,\n        endDate: data.end_date,\n        location: data.location,\n        children: [],\n      };\n\n      setUnions(prev => [...prev, newUnion]);\n      return newUnion;\n    } catch (err) {\n      console.error('Error creating union:', err);\n      return null;\n    }\n  }, [currentFamily?.id]);\n\n  const addChildToUnion = useCallback(async (unionId: string, childId: string): Promise<boolean> => {\n    try {\n      const { error } = await supabase\n        .from('union_children')\n        .insert({\n          union_id: unionId,\n          child_id: childId,\n        });\n\n      if (error) throw error;\n\n      // Update local state\n      setUnions(prev => prev.map(u =>\n        u.id === unionId\n          ? { ...u, children: [...u.children, childId] }\n          : u\n      ));\n\n      return true;\n    } catch (err) {\n      console.error('Error adding child to union:', err);\n      return false;\n    }\n  }, []);\n\n  const createRelationship = useCallback(async (\n    person1Id: string,\n    person2Id: string,\n    type: string,\n    isBiological: boolean = true\n  ): Promise<boolean> => {\n    if (!currentFamily?.id) return false;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return false;\n\n    try {\n      const { error } = await supabase\n        .from('relationships')\n        .insert({\n          family_id: currentFamily.id,\n          person1_id: person1Id,\n          person2_id: person2Id,\n          relationship_type: type,\n          is_biological: isBiological,\n          created_by: userData.user.id,\n        });\n\n      if (error) throw error;\n\n      // Refresh data\n      await fetchTreeData(currentFamily.id);\n      return true;\n    } catch (err) {\n      console.error('Error creating relationship:', err);\n      return false;\n    }\n  }, [currentFamily?.id, fetchTreeData]);\n\n  const getPersonById = useCallback((personId: string): Person | undefined => {\n    return persons.find(p => p.id === personId);\n  }, [persons]);\n\n  const refresh = useCallback(async () => {\n    if (currentFamily?.id) {\n      await fetchTreeData(currentFamily.id);\n    }\n  }, [currentFamily?.id, fetchTreeData]);\n\n  // Get root person (first person added or self-marked person)\n  const getRootPerson = useCallback((): Person | null => {\n    if (persons.length === 0) return null;\n    // For now, return the first person created\n    return persons[0];\n  }, [persons]);\n\n  // Find or create a union between two people\n  const findOrCreateUnion = useCallback(async (\n    partner1Id: string,\n    partner2Id: string | null,\n    type: string = 'marriage'\n  ): Promise<string | null> => {\n    // Look for existing union\n    const existingUnion = unions.find(u =>\n      (u.partner1Id === partner1Id && u.partner2Id === partner2Id) ||\n      (u.partner1Id === partner2Id && u.partner2Id === partner1Id)\n    );\n\n    if (existingUnion) {\n      return existingUnion.id;\n    }\n\n    // Create new union\n    const newUnion = await createUnion(partner1Id, partner2Id, type);\n    return newUnion?.id || null;\n  }, [unions, createUnion]);\n\n  // Get parents of a person\n  const getParentsOfPerson = useCallback((personId: string): { fatherId?: string; motherId?: string; unionId?: string } => {\n    // Find union where this person is a child\n    for (const union of unions) {\n      if (union.children.includes(personId)) {\n        const partner1 = persons.find(p => p.id === union.partner1Id);\n        const partner2 = persons.find(p => p.id === union.partner2Id);\n\n        let fatherId: string | undefined;\n        let motherId: string | undefined;\n\n        if (partner1?.gender === 'male') fatherId = partner1.id;\n        else if (partner1?.gender === 'female') motherId = partner1.id;\n\n        if (partner2?.gender === 'male') fatherId = partner2.id;\n        else if (partner2?.gender === 'female') motherId = partner2.id;\n\n        return { fatherId, motherId, unionId: union.id };\n      }\n    }\n    return {};\n  }, [unions, persons]);\n\n  // Get spouse of a person\n  const getSpouseOfPerson = useCallback((personId: string): Person | null => {\n    for (const union of unions) {\n      if (union.partner1Id === personId && union.partner2Id) {\n        return persons.find(p => p.id === union.partner2Id) || null;\n      }\n      if (union.partner2Id === personId) {\n        return persons.find(p => p.id === union.partner1Id) || null;\n      }\n    }\n    return null;\n  }, [unions, persons]);\n\n  // Create person with relationship - the main function for adding family members\n  const createPersonWithRelationship = useCallback(async (\n    input: CreatePersonWithRelationshipInput\n  ): Promise<Person | null> => {\n    if (!currentFamily?.id) return null;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    try {\n      // First, create the person\n      const { data: personData, error: personError } = await supabase\n        .from('persons')\n        .insert({\n          family_id: currentFamily.id,\n          first_name: input.firstName,\n          last_name: input.lastName,\n          gender: input.gender,\n          birth_date: input.birthDate,\n          is_living: input.isLiving ?? true,\n          photo_url: input.photoUrl,\n          medical_conditions: input.medicalConditions || null,\n          created_by: userData.user.id,\n        })\n        .select()\n        .single();\n\n      if (personError) throw personError;\n\n      const newPersonId = personData.id;\n      const relatedToId = input.relatedToPersonId;\n\n      // Now handle the relationship based on type\n      switch (input.relationshipType) {\n        case 'self':\n          // This is the root person, no relationship needed\n          break;\n\n        case 'father':\n        case 'mother': {\n          // Adding a parent to the related person\n          if (!relatedToId) break;\n\n          // Get existing parents of the related person\n          const existingParents = getParentsOfPerson(relatedToId);\n\n          if (existingParents.unionId) {\n            // Union exists, update it to add this parent as the second partner\n            if (input.relationshipType === 'father' && !existingParents.fatherId) {\n              // If partner1 is already the mother, add father as partner2\n              // Otherwise update partner1\n              const currentUnion = unions.find(u => u.id === existingParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', existingParents.unionId);\n              } else {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', existingParents.unionId);\n              }\n            } else if (input.relationshipType === 'mother' && !existingParents.motherId) {\n              const currentUnion = unions.find(u => u.id === existingParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', existingParents.unionId);\n              } else {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', existingParents.unionId);\n              }\n            }\n          } else {\n            // Create new union with new parent and add related person as child\n            // The new parent is always partner1, partner2 will be added later\n            const union = await createUnion(newPersonId, null, 'marriage');\n            if (union) {\n              await addChildToUnion(union.id, relatedToId);\n            }\n          }\n\n          // Create parent-child relationship\n          await createRelationship(newPersonId, relatedToId, 'parent_child', true);\n          break;\n        }\n\n        case 'spouse': {\n          // Adding a spouse to the related person\n          if (!relatedToId) break;\n\n          // Create or find union between them\n          await findOrCreateUnion(relatedToId, newPersonId, 'marriage');\n\n          // Create spouse relationship\n          await createRelationship(relatedToId, newPersonId, 'spouse', false);\n          break;\n        }\n\n        case 'son':\n        case 'daughter': {\n          // Adding a child to the related person\n          if (!relatedToId) break;\n\n          // Find or create union for the parent\n          const spouse = getSpouseOfPerson(relatedToId);\n          let unionId: string | null = null;\n\n          if (spouse) {\n            // Find existing union with spouse\n            unionId = await findOrCreateUnion(relatedToId, spouse.id, 'marriage');\n          } else {\n            // Create single-parent union\n            const union = await createUnion(relatedToId, null, 'other');\n            unionId = union?.id || null;\n          }\n\n          if (unionId) {\n            await addChildToUnion(unionId, newPersonId);\n          }\n\n          // Create parent-child relationship\n          await createRelationship(relatedToId, newPersonId, 'parent_child', true);\n          break;\n        }\n\n        case 'brother':\n        case 'sister': {\n          // Adding a sibling to the related person\n          if (!relatedToId) break;\n\n          // Find the parents union of the related person\n          const existingParents = getParentsOfPerson(relatedToId);\n\n          if (existingParents.unionId) {\n            // Add to same union as sibling (they share the same parents)\n            await addChildToUnion(existingParents.unionId, newPersonId);\n          }\n          // If no parents exist yet, we just create the sibling relationship\n          // Parents can be added later, and both siblings will be linked to them\n\n          // Create sibling relationship\n          await createRelationship(relatedToId, newPersonId, 'sibling', true);\n          break;\n        }\n\n        case 'grandfather_paternal':\n        case 'grandmother_paternal': {\n          // Adding paternal grandparent\n          if (!relatedToId) break;\n\n          const parents = getParentsOfPerson(relatedToId);\n          if (parents.fatherId) {\n            // Add as parent of the father\n            const fatherParents = getParentsOfPerson(parents.fatherId);\n\n            if (fatherParents.unionId) {\n              // Update existing grandparents union - add as second partner\n              const currentUnion = unions.find(u => u.id === fatherParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', fatherParents.unionId);\n              } else if (!currentUnion?.partner1Id) {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', fatherParents.unionId);\n              }\n            } else {\n              // Create new union and add father as child\n              const union = await createUnion(newPersonId, null, 'marriage');\n              if (union) {\n                await addChildToUnion(union.id, parents.fatherId);\n              }\n            }\n\n            await createRelationship(newPersonId, parents.fatherId, 'parent_child', true);\n          }\n          break;\n        }\n\n        case 'grandfather_maternal':\n        case 'grandmother_maternal': {\n          // Adding maternal grandparent\n          if (!relatedToId) break;\n\n          const parents = getParentsOfPerson(relatedToId);\n          if (parents.motherId) {\n            // Add as parent of the mother\n            const motherParents = getParentsOfPerson(parents.motherId);\n\n            if (motherParents.unionId) {\n              // Update existing grandparents union - add as second partner\n              const currentUnion = unions.find(u => u.id === motherParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', motherParents.unionId);\n              } else if (!currentUnion?.partner1Id) {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', motherParents.unionId);\n              }\n            } else {\n              // Create new union and add mother as child\n              const union = await createUnion(newPersonId, null, 'marriage');\n              if (union) {\n                await addChildToUnion(union.id, parents.motherId);\n              }\n            }\n\n            await createRelationship(newPersonId, parents.motherId, 'parent_child', true);\n          }\n          break;\n        }\n\n        case 'uncle':\n        case 'aunt': {\n          // Adding uncle/aunt (sibling of parent)\n          if (!relatedToId) break;\n\n          const parents = getParentsOfPerson(relatedToId);\n          const parentId = input.gender === 'male'\n            ? (parents.fatherId || parents.motherId)\n            : (parents.motherId || parents.fatherId);\n\n          if (parentId) {\n            // Find grandparents union\n            const grandparents = getParentsOfPerson(parentId);\n\n            if (grandparents.unionId) {\n              // Add new person as child of grandparents\n              await addChildToUnion(grandparents.unionId, newPersonId);\n              await createRelationship(parentId, newPersonId, 'sibling', true);\n            }\n          }\n          break;\n        }\n\n        case 'cousin': {\n          // Adding a cousin is complex - need to find uncle/aunt first\n          // For now, just add as a person without automatic relationship\n          console.log('Cousin relationship requires manual setup');\n          break;\n        }\n      }\n\n      // Refresh all data\n      await fetchTreeData(currentFamily.id);\n\n      // Return the created person (constructed from the insert response)\n      const createdPerson: Person = {\n        id: personData.id,\n        familyId: personData.family_id,\n        firstName: personData.first_name,\n        lastName: personData.last_name,\n        gender: personData.gender as Gender,\n        birthDate: personData.birth_date,\n        isLiving: personData.is_living,\n        photoUrl: personData.photo_url,\n        medicalConditions: personData.medical_conditions,\n        createdAt: personData.created_at,\n      };\n\n      return createdPerson;\n    } catch (err) {\n      console.error('Error creating person with relationship:', err);\n      setError('Error creating person');\n      return null;\n    }\n  }, [\n    currentFamily?.id,\n    supabase,\n    createUnion,\n    addChildToUnion,\n    createRelationship,\n    getParentsOfPerson,\n    getSpouseOfPerson,\n    findOrCreateUnion,\n    fetchTreeData,\n    persons,\n  ]);\n\n  // Calculate the relationship role of a person relative to the root person\n  const getPersonRole = useCallback((personId: string): string | null => {\n    const root = getRootPerson();\n    if (!root) return null;\n    if (personId === root.id) return 'Me';\n\n    const person = persons.find(p => p.id === personId);\n    if (!person) return null;\n\n    // Get parents of root person\n    const rootParents = getParentsOfPerson(root.id);\n\n    // Check if person is parent of root\n    if (rootParents.fatherId === personId) return 'Father';\n    if (rootParents.motherId === personId) return 'Mother';\n\n    // Check if person is spouse of root\n    const rootSpouse = getSpouseOfPerson(root.id);\n    if (rootSpouse?.id === personId) {\n      return person.gender === 'male' ? 'Husband' : 'Wife';\n    }\n\n    // Check if person is child of root (root is parent in a union)\n    for (const union of unions) {\n      if (union.partner1Id === root.id || union.partner2Id === root.id) {\n        if (union.children.includes(personId)) {\n          return person.gender === 'male' ? 'Son' : 'Daughter';\n        }\n      }\n    }\n\n    // Check if person is sibling (shares same parents as root)\n    if (rootParents.unionId) {\n      const rootUnion = unions.find(u => u.id === rootParents.unionId);\n      if (rootUnion && rootUnion.children.includes(personId)) {\n        return person.gender === 'male' ? 'Brother' : 'Sister';\n      }\n    }\n\n    // Also check sibling relationship in relationships table\n    const siblingRelationship = relationships.find(r =>\n    (r.relationshipType === 'sibling' &&\n      ((r.person1Id === root.id && r.person2Id === personId) ||\n        (r.person1Id === personId && r.person2Id === root.id)))\n    );\n    if (siblingRelationship) {\n      return person.gender === 'male' ? 'Brother' : 'Sister';\n    }\n\n    // Check if they share at least one parent (alternative sibling check)\n    const personParents = getParentsOfPerson(personId);\n    if ((rootParents.fatherId && rootParents.fatherId === personParents.fatherId) ||\n      (rootParents.motherId && rootParents.motherId === personParents.motherId)) {\n      return person.gender === 'male' ? 'Brother' : 'Sister';\n    }\n\n    // Check if person is grandparent\n    if (rootParents.fatherId) {\n      const fatherParents = getParentsOfPerson(rootParents.fatherId);\n      if (fatherParents.fatherId === personId) return 'Paternal Grandfather';\n      if (fatherParents.motherId === personId) return 'Paternal Grandmother';\n    }\n    if (rootParents.motherId) {\n      const motherParents = getParentsOfPerson(rootParents.motherId);\n      if (motherParents.fatherId === personId) return 'Maternal Grandfather';\n      if (motherParents.motherId === personId) return 'Maternal Grandmother';\n    }\n\n    // Check if person is uncle/aunt (sibling of root's parents)\n    if (rootParents.fatherId) {\n      const fatherParents = getParentsOfPerson(rootParents.fatherId);\n      if (fatherParents.unionId) {\n        const fatherSiblingsUnion = unions.find(u => u.id === fatherParents.unionId);\n        if (fatherSiblingsUnion) {\n          // Filter out the root's father himself from the siblings\n          const siblingsOfFather = fatherSiblingsUnion.children.filter(id => id !== rootParents.fatherId);\n          if (siblingsOfFather.includes(personId)) {\n            return person.gender === 'male' ? 'Uncle' : 'Aunt';\n          }\n        }\n      }\n    }\n    if (rootParents.motherId) {\n      const motherParents = getParentsOfPerson(rootParents.motherId);\n      if (motherParents.unionId) {\n        const motherSiblingsUnion = unions.find(u => u.id === motherParents.unionId);\n        if (motherSiblingsUnion) {\n          // Filter out the root's mother herself from the siblings\n          const siblingsOfMother = motherSiblingsUnion.children.filter(id => id !== rootParents.motherId);\n          if (siblingsOfMother.includes(personId)) {\n            return person.gender === 'male' ? 'Uncle' : 'Aunt';\n          }\n        }\n      }\n    }\n\n    // Check if person is grandchild\n    for (const union of unions) {\n      if (union.partner1Id === root.id || union.partner2Id === root.id) {\n        for (const childId of union.children) {\n          // Check if this child has children that include the person\n          for (const childUnion of unions) {\n            if (childUnion.partner1Id === childId || childUnion.partner2Id === childId) {\n              if (childUnion.children.includes(personId)) {\n                return person.gender === 'male' ? 'Grandson' : 'Granddaughter';\n              }\n            }\n          }\n        }\n      }\n    }\n\n    // Check if person is nephew/niece (child of sibling)\n    if (rootParents.unionId) {\n      const rootUnion = unions.find(u => u.id === rootParents.unionId);\n      if (rootUnion) {\n        for (const siblingId of rootUnion.children) {\n          if (siblingId === root.id) continue; // Skip the root person themselves\n          // Check if person is child of this sibling\n          for (const siblingUnion of unions) {\n            if (siblingUnion.partner1Id === siblingId || siblingUnion.partner2Id === siblingId) {\n              if (siblingUnion.children.includes(personId)) {\n                return person.gender === 'male' ? 'Nephew' : 'Niece';\n              }\n            }\n          }\n        }\n      }\n    }\n\n    // Check if person is cousin (child of uncle/aunt)\n    // First get uncles/aunts\n    const unclesAunts: string[] = [];\n    if (rootParents.fatherId) {\n      const fatherParents = getParentsOfPerson(rootParents.fatherId);\n      if (fatherParents.unionId) {\n        const fatherSiblingsUnion = unions.find(u => u.id === fatherParents.unionId);\n        if (fatherSiblingsUnion) {\n          unclesAunts.push(...fatherSiblingsUnion.children.filter(id => id !== rootParents.fatherId));\n        }\n      }\n    }\n    if (rootParents.motherId) {\n      const motherParents = getParentsOfPerson(rootParents.motherId);\n      if (motherParents.unionId) {\n        const motherSiblingsUnion = unions.find(u => u.id === motherParents.unionId);\n        if (motherSiblingsUnion) {\n          unclesAunts.push(...motherSiblingsUnion.children.filter(id => id !== rootParents.motherId));\n        }\n      }\n    }\n\n    // Check if person is child of any uncle/aunt\n    for (const uncleAuntId of unclesAunts) {\n      for (const uncleAuntUnion of unions) {\n        if (uncleAuntUnion.partner1Id === uncleAuntId || uncleAuntUnion.partner2Id === uncleAuntId) {\n          if (uncleAuntUnion.children.includes(personId)) {\n            return 'Cousin';\n          }\n        }\n      }\n    }\n\n    return 'Relative';\n  }, [persons, unions, relationships, getRootPerson, getParentsOfPerson, getSpouseOfPerson]);\n\n  return {\n    persons,\n    unions,\n    relationships,\n    graphData,\n    isLoading,\n    error,\n    createPerson,\n    createPersonWithRelationship,\n    updatePerson,\n    deletePerson,\n    createUnion,\n    addChildToUnion,\n    createRelationship,\n    getPersonById,\n    getRootPerson,\n    getParentsOfPerson,\n    getSpouseOfPerson,\n    getPersonRole,\n    refresh,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 928, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/hooks/useDYKQuiz.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useMemo, useCallback } from 'react';\nimport { createClient } from '@/lib/supabase';\nimport { useFamily } from './useFamily';\nimport { useFamilyTree } from './useFamilyTree';\n\nexport interface QuizQuestion {\n    id: string;\n    question: string;\n    category: 'maternal' | 'paternal' | 'self' | 'extended';\n    difficulty: 'easy' | 'medium' | 'hard';\n    answerType: 'multiple_choice' | 'text' | 'date' | 'yes_no';\n    options?: string[];\n    correctAnswer: string;\n    relatedPersonId?: string;\n    relatedPersonName?: string;\n    points: number;\n}\n\nexport interface QuizStats {\n    totalQuestions: number;\n    answered: number;\n    correct: number;\n    score: number;\n    level: 'beginner' | 'medium' | 'high';\n    categoryProgress: {\n        maternal: number;\n        paternal: number;\n        self: number;\n        extended: number;\n    };\n}\n\nexport interface QuizResponse {\n    questionId: string;\n    response: string;\n    isCorrect: boolean;\n    answeredAt: string;\n}\n\nexport function useDYKQuiz() {\n    const supabase = useMemo(() => createClient(), []);\n    const { currentFamily } = useFamily();\n    const { persons, unions } = useFamilyTree();\n\n    const [questions, setQuestions] = useState<QuizQuestion[]>([]);\n    const [responses, setResponses] = useState<QuizResponse[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [stats, setStats] = useState<QuizStats>({\n        totalQuestions: 0,\n        answered: 0,\n        correct: 0,\n        score: 0,\n        level: 'beginner',\n        categoryProgress: { maternal: 0, paternal: 0, self: 0, extended: 0 },\n    });\n\n    // Generate questions based on family data\n    const generateQuestions = useCallback((): QuizQuestion[] => {\n        if (persons.length === 0) return [];\n\n        const generatedQuestions: QuizQuestion[] = [];\n\n        persons.forEach((person, index) => {\n            const personName = `${person.firstName} ${person.lastName || ''}`.trim();\n\n            // Birth date question\n            if (person.birthDate) {\n                const birthYear = new Date(person.birthDate).getFullYear();\n                const wrongYears = [birthYear - 2, birthYear + 3, birthYear - 5].filter(y => y > 1900);\n\n                generatedQuestions.push({\n                    id: `birth-year-${person.id}`,\n                    question: `En qu ao naci ${personName}?`,\n                    category: index % 2 === 0 ? 'maternal' : 'paternal',\n                    difficulty: 'medium',\n                    answerType: 'multiple_choice',\n                    options: shuffleArray([birthYear.toString(), ...wrongYears.map(String)]),\n                    correctAnswer: birthYear.toString(),\n                    relatedPersonId: person.id,\n                    relatedPersonName: personName,\n                    points: 10,\n                });\n\n                // Birth month question\n                const birthMonth = new Date(person.birthDate).toLocaleDateString('es', { month: 'long' });\n                const months = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];\n                const wrongMonths = months.filter(m => m !== birthMonth.toLowerCase()).slice(0, 3);\n\n                generatedQuestions.push({\n                    id: `birth-month-${person.id}`,\n                    question: `En qu mes naci ${personName}?`,\n                    category: index % 2 === 0 ? 'maternal' : 'paternal',\n                    difficulty: 'hard',\n                    answerType: 'multiple_choice',\n                    options: shuffleArray([birthMonth, ...wrongMonths]),\n                    correctAnswer: birthMonth,\n                    relatedPersonId: person.id,\n                    relatedPersonName: personName,\n                    points: 15,\n                });\n            }\n\n            // Birth place question\n            if (person.birthPlace) {\n                generatedQuestions.push({\n                    id: `birth-place-${person.id}`,\n                    question: `Dnde naci ${personName}?`,\n                    category: index % 2 === 0 ? 'maternal' : 'paternal',\n                    difficulty: 'hard',\n                    answerType: 'text',\n                    correctAnswer: person.birthPlace,\n                    relatedPersonId: person.id,\n                    relatedPersonName: personName,\n                    points: 20,\n                });\n            }\n\n            // Gender question\n            generatedQuestions.push({\n                id: `gender-${person.id}`,\n                question: `${personName} es hombre o mujer?`,\n                category: 'extended',\n                difficulty: 'easy',\n                answerType: 'multiple_choice',\n                options: ['Hombre', 'Mujer'],\n                correctAnswer: person.gender === 'male' ? 'Hombre' : 'Mujer',\n                relatedPersonId: person.id,\n                relatedPersonName: personName,\n                points: 5,\n            });\n\n            // Is living question\n            generatedQuestions.push({\n                id: `living-${person.id}`,\n                question: `${personName} est vivo/a actualmente?`,\n                category: 'extended',\n                difficulty: 'easy',\n                answerType: 'yes_no',\n                options: ['S', 'No'],\n                correctAnswer: person.isLiving ? 'S' : 'No',\n                relatedPersonId: person.id,\n                relatedPersonName: personName,\n                points: 5,\n            });\n        });\n\n        // Relationship questions from unions\n        unions.forEach((union) => {\n            const partner1 = persons.find(p => p.id === union.partner1Id);\n            const partner2 = persons.find(p => p.id === union.partner2Id);\n\n            if (partner1 && partner2) {\n                const p1Name = `${partner1.firstName} ${partner1.lastName || ''}`.trim();\n                const p2Name = `${partner2.firstName} ${partner2.lastName || ''}`.trim();\n\n                generatedQuestions.push({\n                    id: `spouse-${union.id}`,\n                    question: `Quin es el/la esposo/a de ${p1Name}?`,\n                    category: 'extended',\n                    difficulty: 'medium',\n                    answerType: 'multiple_choice',\n                    options: shuffleArray([p2Name, ...persons.filter(p => p.id !== partner2.id && p.id !== partner1.id).slice(0, 3).map(p => `${p.firstName} ${p.lastName || ''}`.trim())]),\n                    correctAnswer: p2Name,\n                    relatedPersonId: partner1.id,\n                    relatedPersonName: p1Name,\n                    points: 10,\n                });\n\n                // Marriage year question\n                if (union.startDate) {\n                    const marriageYear = new Date(union.startDate).getFullYear();\n                    const wrongYears = [marriageYear - 3, marriageYear + 2, marriageYear - 7];\n\n                    generatedQuestions.push({\n                        id: `marriage-year-${union.id}`,\n                        question: `En qu ao se casaron ${p1Name} y ${p2Name}?`,\n                        category: 'extended',\n                        difficulty: 'hard',\n                        answerType: 'multiple_choice',\n                        options: shuffleArray([marriageYear.toString(), ...wrongYears.map(String)]),\n                        correctAnswer: marriageYear.toString(),\n                        relatedPersonId: union.id,\n                        points: 15,\n                    });\n                }\n            }\n        });\n\n        // Count family members question\n        if (persons.length > 0) {\n            const wrongCounts = [persons.length - 2, persons.length + 3, persons.length + 1].filter(n => n > 0);\n\n            generatedQuestions.push({\n                id: 'family-count',\n                question: 'Cuntas personas hay en tu rbol familiar?',\n                category: 'self',\n                difficulty: 'easy',\n                answerType: 'multiple_choice',\n                options: shuffleArray([persons.length.toString(), ...wrongCounts.map(String)]),\n                correctAnswer: persons.length.toString(),\n                points: 5,\n            });\n        }\n\n        return shuffleArray(generatedQuestions);\n    }, [persons, unions]);\n\n    // Fetch existing responses from database\n    const fetchResponses = useCallback(async () => {\n        if (!currentFamily?.id) return;\n\n        try {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) return;\n\n            const { data, error } = await supabase\n                .from('dyk_responses')\n                .select('question_id, response, is_correct, completed_at')\n                .eq('family_id', currentFamily.id)\n                .eq('user_id', user.id);\n\n            if (error) {\n                // Silently ignore if table doesn't exist - quiz works without persistence\n                const isTableMissing = error.message?.includes('does not exist') ||\n                    error.message?.includes('Could not find');\n                if (!isTableMissing) {\n                    console.error('Error fetching responses:', error);\n                }\n                return;\n            }\n\n            const mappedResponses: QuizResponse[] = (data || []).map((r: any) => ({\n                questionId: r.question_id,\n                response: r.response,\n                isCorrect: r.is_correct,\n                answeredAt: r.completed_at,\n            }));\n\n            setResponses(mappedResponses);\n        } catch (err) {\n            console.error('Error:', err);\n        }\n    }, [currentFamily?.id, supabase]);\n\n    // Calculate stats\n    useEffect(() => {\n        const totalQuestions = questions.length;\n        const answered = responses.length;\n        const correct = responses.filter(r => r.isCorrect).length;\n        const score = answered > 0 ? Math.round((correct / answered) * 100) : 0;\n\n        let level: 'beginner' | 'medium' | 'high' = 'beginner';\n        if (score >= 80) level = 'high';\n        else if (score >= 50) level = 'medium';\n\n        // Calculate category progress\n        const categoryProgress = { maternal: 0, paternal: 0, self: 0, extended: 0 };\n        const categoryCounts = { maternal: 0, paternal: 0, self: 0, extended: 0 };\n        const categoryCorrect = { maternal: 0, paternal: 0, self: 0, extended: 0 };\n\n        questions.forEach(q => {\n            categoryCounts[q.category]++;\n            const response = responses.find(r => r.questionId === q.id);\n            if (response?.isCorrect) {\n                categoryCorrect[q.category]++;\n            }\n        });\n\n        Object.keys(categoryProgress).forEach(cat => {\n            const key = cat as keyof typeof categoryProgress;\n            categoryProgress[key] = categoryCounts[key] > 0\n                ? Math.round((categoryCorrect[key] / categoryCounts[key]) * 100)\n                : 0;\n        });\n\n        setStats({\n            totalQuestions,\n            answered,\n            correct,\n            score,\n            level,\n            categoryProgress,\n        });\n    }, [questions, responses]);\n\n    // Load questions and responses\n    useEffect(() => {\n        setIsLoading(true);\n        const generated = generateQuestions();\n        setQuestions(generated);\n        fetchResponses().finally(() => setIsLoading(false));\n    }, [generateQuestions, fetchResponses]);\n\n    // Submit answer\n    const submitAnswer = useCallback(async (questionId: string, answer: string): Promise<boolean> => {\n        if (!currentFamily?.id) return false;\n\n        const question = questions.find(q => q.id === questionId);\n        if (!question) return false;\n\n        // Check if answer is correct\n        let isCorrect = false;\n        if (question.answerType === 'text') {\n            // For text answers, do case-insensitive comparison\n            isCorrect = answer.toLowerCase().trim() === question.correctAnswer.toLowerCase().trim();\n        } else {\n            isCorrect = answer === question.correctAnswer;\n        }\n\n        // Function to update local state\n        const updateLocalState = () => {\n            setResponses(prev => {\n                const existing = prev.findIndex(r => r.questionId === questionId);\n                const newResponse = {\n                    questionId,\n                    response: answer,\n                    isCorrect,\n                    answeredAt: new Date().toISOString(),\n                };\n\n                if (existing >= 0) {\n                    const updated = [...prev];\n                    updated[existing] = newResponse;\n                    return updated;\n                }\n                return [...prev, newResponse];\n            });\n        };\n\n        try {\n            const { data: { user } } = await supabase.auth.getUser();\n            if (!user) {\n                // Still update local state even without auth\n                updateLocalState();\n                return isCorrect;\n            }\n\n            // Save response directly with the generated question ID\n            // No need to create a dyk_questions record for dynamically generated questions\n            const pointsEarned = isCorrect ? question.points : 0;\n            const { error: responseError } = await supabase\n                .from('dyk_responses')\n                .upsert({\n                    family_id: currentFamily.id,\n                    user_id: user.id,\n                    question_id: questionId, // Use the original generated ID\n                    response: answer,\n                    is_correct: isCorrect,\n                    points_earned: pointsEarned,\n                    completed_at: new Date().toISOString(),\n                }, {\n                    onConflict: 'family_id,user_id,question_id'\n                });\n\n            if (responseError) {\n                // Silently ignore if table doesn't exist - quiz still works locally\n                const isTableMissing = responseError.message?.includes('does not exist') ||\n                    responseError.message?.includes('Could not find');\n                if (!isTableMissing) {\n                    console.error('Error saving response:', responseError);\n                }\n            }\n\n            // Update local state\n            updateLocalState();\n\n            return isCorrect;\n        } catch (err) {\n            console.error('Error submitting answer:', err);\n            return false;\n        }\n    }, [currentFamily?.id, questions, supabase]);\n\n    // Get unanswered questions for quiz\n    const getQuizQuestions = useCallback((count: number = 10): QuizQuestion[] => {\n        const answeredIds = new Set(responses.map(r => r.questionId));\n        const unanswered = questions.filter(q => !answeredIds.has(q.id));\n        return unanswered.slice(0, count);\n    }, [questions, responses]);\n\n    return {\n        questions,\n        responses,\n        stats,\n        isLoading,\n        submitAnswer,\n        getQuizQuestions,\n        refreshQuestions: () => {\n            const generated = generateQuestions();\n            setQuestions(generated);\n        },\n    };\n}\n\n// Utility function to shuffle array\nfunction shuffleArray<T>(array: T[]): T[] {\n    const shuffled = [...array];\n    for (let i = shuffled.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n    }\n    return shuffled;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1418, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/app/%28dashboard%29/dyk/quiz/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useRef } from 'react';\nimport { useRouter } from 'next/navigation';\nimport {\n  Container,\n  Card,\n  Button,\n  Skeleton,\n} from '@kintree/ui';\nimport { useDYKQuiz, type QuizQuestion } from '@/hooks/useDYKQuiz';\n\nexport default function QuizPage() {\n  const router = useRouter();\n  const { getQuizQuestions, submitAnswer, stats, isLoading } = useDYKQuiz();\n\n  const [quizQuestions, setQuizQuestions] = useState<QuizQuestion[]>([]);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);\n  const [textAnswer, setTextAnswer] = useState('');\n  const [showResult, setShowResult] = useState(false);\n  const [isCorrect, setIsCorrect] = useState(false);\n  const [quizComplete, setQuizComplete] = useState(false);\n  const [correctCount, setCorrectCount] = useState(0);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const questionsLoadedRef = useRef(false);\n\n  // Load quiz questions only once when data is ready\n  useEffect(() => {\n    if (!isLoading && !questionsLoadedRef.current) {\n      questionsLoadedRef.current = true;\n      const questions = getQuizQuestions(10);\n      setQuizQuestions(questions);\n\n      if (questions.length === 0) {\n        setQuizComplete(true);\n      }\n    }\n  }, [isLoading, getQuizQuestions]);\n\n  const currentQuestion = quizQuestions[currentIndex];\n\n  const handleSubmitAnswer = async () => {\n    if (!currentQuestion) return;\n\n    const answer = currentQuestion.answerType === 'text' ? textAnswer : selectedAnswer;\n    if (!answer) return;\n\n    setIsSubmitting(true);\n    const correct = await submitAnswer(currentQuestion.id, answer);\n    setIsCorrect(correct);\n    setShowResult(true);\n\n    if (correct) {\n      setCorrectCount(prev => prev + 1);\n    }\n\n    setIsSubmitting(false);\n  };\n\n  const handleNextQuestion = () => {\n    setShowResult(false);\n    setSelectedAnswer(null);\n    setTextAnswer('');\n\n    if (currentIndex + 1 >= quizQuestions.length) {\n      setQuizComplete(true);\n    } else {\n      setCurrentIndex(prev => prev + 1);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Container size=\"md\" padding={false}>\n        <div className=\"min-h-[60vh] flex items-center justify-center\">\n          <Skeleton width={400} height={300} />\n        </div>\n      </Container>\n    );\n  }\n\n  if (quizComplete) {\n    const percentage = quizQuestions.length > 0\n      ? Math.round((correctCount / quizQuestions.length) * 100)\n      : 0;\n\n    return (\n      <Container size=\"md\" padding={false}>\n        <div className=\"min-h-[60vh] flex items-center justify-center\">\n          <Card padding=\"lg\" className=\"w-full max-w-md text-center\">\n            <div className=\"mb-6\">\n              {percentage >= 80 ? (\n                <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <TrophyIcon className=\"w-10 h-10 text-green-600\" />\n                </div>\n              ) : percentage >= 50 ? (\n                <div className=\"w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <StarIcon className=\"w-10 h-10 text-yellow-600\" />\n                </div>\n              ) : (\n                <div className=\"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <BookIcon className=\"w-10 h-10 text-blue-600\" />\n                </div>\n              )}\n\n              <h2 className=\"text-2xl font-bold text-neutral-900 mb-2\">\n                {quizQuestions.length === 0\n                  ? 'No hay preguntas disponibles!'\n                  : percentage >= 80\n                    ? 'Excelente!'\n                    : percentage >= 50\n                      ? 'Buen trabajo!'\n                      : 'Sigue aprendiendo!'}\n              </h2>\n\n              {quizQuestions.length > 0 && (\n                <>\n                  <p className=\"text-4xl font-bold text-primary-600 mb-2\">\n                    {correctCount} / {quizQuestions.length}\n                  </p>\n                  <p className=\"text-neutral-500\">\n                    Respondiste correctamente el {percentage}% de las preguntas\n                  </p>\n                </>\n              )}\n\n              {quizQuestions.length === 0 && (\n                <p className=\"text-neutral-500\">\n                  Agrega ms personas a tu rbol familiar para generar preguntas del quiz.\n                </p>\n              )}\n            </div>\n\n            <div className=\"space-y-3\">\n              <Button fullWidth onClick={() => router.push('/dyk')}>\n                Volver al inicio\n              </Button>\n              {quizQuestions.length > 0 && (\n                <Button\n                  fullWidth\n                  variant=\"outline\"\n                  onClick={() => {\n                    setQuizComplete(false);\n                    setCurrentIndex(0);\n                    setCorrectCount(0);\n                    setShowResult(false);\n                    setSelectedAnswer(null);\n                    setTextAnswer('');\n                    questionsLoadedRef.current = false;\n                    // Need to reload with fresh questions\n                    const questions = getQuizQuestions(10);\n                    setQuizQuestions(questions);\n                    if (questions.length === 0) {\n                      setQuizComplete(true);\n                    }\n                  }}\n                >\n                  Jugar de nuevo\n                </Button>\n              )}\n            </div>\n          </Card>\n        </div>\n      </Container>\n    );\n  }\n\n  if (!currentQuestion) {\n    return (\n      <Container size=\"md\" padding={false}>\n        <div className=\"min-h-[60vh] flex items-center justify-center\">\n          <Card padding=\"lg\" className=\"w-full max-w-md text-center\">\n            <p className=\"text-neutral-500\">Cargando preguntas...</p>\n          </Card>\n        </div>\n      </Container>\n    );\n  }\n\n  return (\n    <Container size=\"md\" padding={false}>\n      {/* Progress bar */}\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => router.push('/dyk')}>\n            <ArrowLeftIcon className=\"w-5 h-5 mr-1\" />\n            Salir\n          </Button>\n          <span className=\"text-sm text-neutral-500\">\n            Pregunta {currentIndex + 1} de {quizQuestions.length}\n          </span>\n        </div>\n        <div className=\"h-2 bg-neutral-100 rounded-full overflow-hidden\">\n          <div\n            className=\"h-full bg-primary-500 rounded-full transition-all duration-300\"\n            style={{ width: `${((currentIndex + 1) / quizQuestions.length) * 100}%` }}\n          />\n        </div>\n      </div>\n\n      {/* Question Card */}\n      <Card padding=\"lg\" className=\"mb-6\">\n        {/* Category & Difficulty */}\n        <div className=\"flex items-center gap-2 mb-4\">\n          <span className={`text-xs px-2 py-1 rounded-full ${\n            currentQuestion.category === 'maternal' ? 'bg-pink-100 text-pink-700' :\n            currentQuestion.category === 'paternal' ? 'bg-blue-100 text-blue-700' :\n            currentQuestion.category === 'self' ? 'bg-purple-100 text-purple-700' :\n            'bg-green-100 text-green-700'\n          }`}>\n            {currentQuestion.category === 'maternal' ? 'Lnea Materna' :\n             currentQuestion.category === 'paternal' ? 'Lnea Paterna' :\n             currentQuestion.category === 'self' ? 'Personal' : 'Familia Extendida'}\n          </span>\n          <span className={`text-xs px-2 py-1 rounded-full ${\n            currentQuestion.difficulty === 'easy' ? 'bg-green-100 text-green-700' :\n            currentQuestion.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-700' :\n            'bg-red-100 text-red-700'\n          }`}>\n            {currentQuestion.points} pts\n          </span>\n        </div>\n\n        {/* Question */}\n        <h2 className=\"text-xl font-semibold text-neutral-900 mb-6\">\n          {currentQuestion.question}\n        </h2>\n\n        {/* Answer Options */}\n        {!showResult ? (\n          <div className=\"space-y-3\">\n            {currentQuestion.answerType === 'text' ? (\n              <input\n                type=\"text\"\n                value={textAnswer}\n                onChange={(e) => setTextAnswer(e.target.value)}\n                placeholder=\"Escribe tu respuesta...\"\n                className=\"w-full p-4 border border-neutral-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              />\n            ) : (\n              currentQuestion.options?.map((option) => (\n                <button\n                  key={option}\n                  onClick={() => setSelectedAnswer(option)}\n                  className={`w-full p-4 text-left rounded-xl border-2 transition-all ${\n                    selectedAnswer === option\n                      ? 'border-primary-500 bg-primary-50'\n                      : 'border-neutral-200 hover:border-neutral-300'\n                  }`}\n                >\n                  <span className={selectedAnswer === option ? 'text-primary-700' : 'text-neutral-700'}>\n                    {option}\n                  </span>\n                </button>\n              ))\n            )}\n\n            <Button\n              fullWidth\n              size=\"lg\"\n              className=\"mt-4\"\n              disabled={currentQuestion.answerType === 'text' ? !textAnswer.trim() : !selectedAnswer}\n              loading={isSubmitting}\n              onClick={handleSubmitAnswer}\n            >\n              Confirmar respuesta\n            </Button>\n          </div>\n        ) : (\n          /* Result */\n          <div className=\"space-y-4\">\n            <div className={`p-4 rounded-xl ${\n              isCorrect ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'\n            }`}>\n              <div className=\"flex items-center gap-3 mb-2\">\n                {isCorrect ? (\n                  <CheckCircleIcon className=\"w-6 h-6 text-green-600\" />\n                ) : (\n                  <XCircleIcon className=\"w-6 h-6 text-red-600\" />\n                )}\n                <span className={`font-semibold ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>\n                  {isCorrect ? 'Correcto!' : 'Incorrecto'}\n                </span>\n              </div>\n              {!isCorrect && (\n                <p className=\"text-sm text-neutral-600\">\n                  La respuesta correcta es: <strong>{currentQuestion.correctAnswer}</strong>\n                </p>\n              )}\n            </div>\n\n            <Button fullWidth size=\"lg\" onClick={handleNextQuestion}>\n              {currentIndex + 1 >= quizQuestions.length ? 'Ver resultados' : 'Siguiente pregunta'}\n            </Button>\n          </div>\n        )}\n      </Card>\n\n      {/* Current Score */}\n      <div className=\"text-center text-sm text-neutral-500\">\n        Respuestas correctas: {correctCount} / {currentIndex + (showResult ? 1 : 0)}\n      </div>\n    </Container>\n  );\n}\n\n// Icons\nfunction ArrowLeftIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M19 12H5M12 19l-7-7 7-7\" />\n    </svg>\n  );\n}\n\nfunction TrophyIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M6 9H4.5a2.5 2.5 0 010-5H6M18 9h1.5a2.5 2.5 0 000-5H18M4 22h16M10 22V8M14 22V8\" />\n      <path d=\"M18 2H6v7a6 6 0 0012 0V2z\" />\n    </svg>\n  );\n}\n\nfunction StarIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <polygon points=\"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2\" />\n    </svg>\n  );\n}\n\nfunction BookIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M4 19.5A2.5 2.5 0 016.5 17H20\" />\n      <path d=\"M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z\" />\n    </svg>\n  );\n}\n\nfunction CheckCircleIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      <path d=\"M9 12l2 2 4-4\" />\n    </svg>\n  );\n}\n\nfunction XCircleIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      <path d=\"M15 9l-6 6M9 9l6 6\" />\n    </svg>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}