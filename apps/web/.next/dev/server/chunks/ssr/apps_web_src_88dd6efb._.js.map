{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/hooks/useFamilyTree.ts"],"sourcesContent":["'use client';\n\nimport { useEffect, useCallback, useState, useMemo } from 'react';\nimport { useFamilyStore } from '@/stores/familyStore';\nimport { createClient } from '@/lib/supabase';\nimport type { GraphData, GraphPerson, GraphUnion, GraphRelationship } from '@kintree/graph-engine';\nimport type { Gender } from '@kintree/shared';\n\nexport interface Person {\n  id: string;\n  familyId: string;\n  firstName: string;\n  middleNames?: string[];\n  lastName?: string;\n  maidenName?: string;\n  nicknames?: string[];\n  birthDate?: string;\n  birthDateApproximate?: boolean;\n  birthPlace?: string;\n  deathDate?: string;\n  deathDateApproximate?: boolean;\n  deathPlace?: string;\n  gender: Gender;\n  isLiving: boolean;\n  biography?: string;\n  photoUrl?: string;\n  medicalConditions?: any[];\n  linkedUserId?: string;\n  createdAt: string;\n}\n\nexport interface Union {\n  id: string;\n  familyId: string;\n  partner1Id: string;\n  partner2Id?: string;\n  unionType: string;\n  startDate?: string;\n  endDate?: string;\n  location?: string;\n  children: string[];\n}\n\nexport interface Relationship {\n  id: string;\n  familyId: string;\n  person1Id: string;\n  person2Id: string;\n  relationshipType: string;\n  isBiological: boolean;\n}\n\nexport interface MedicalCondition {\n  id: string;\n  name: string;\n  severity?: 'mild' | 'moderate' | 'severe';\n  diagnosed?: string; // Date of diagnosis\n  notes?: string;\n}\n\nexport interface CreatePersonInput {\n  firstName: string;\n  lastName?: string;\n  gender: Gender;\n  birthDate?: string;\n  isLiving?: boolean;\n  photoUrl?: string;\n  medicalConditions?: MedicalCondition[];\n}\n\nexport type RelationshipTypeOption =\n  | 'self'           // Root person (me)\n  | 'father'\n  | 'mother'\n  | 'spouse'\n  | 'son'\n  | 'daughter'\n  | 'brother'\n  | 'sister'\n  | 'grandfather_paternal'\n  | 'grandmother_paternal'\n  | 'grandfather_maternal'\n  | 'grandmother_maternal'\n  | 'uncle'\n  | 'aunt'\n  | 'cousin';\n\nexport interface CreatePersonWithRelationshipInput extends CreatePersonInput {\n  relationshipType: RelationshipTypeOption;\n  relatedToPersonId?: string; // The person this new person is related to\n}\n\nexport function useFamilyTree() {\n  const currentFamily = useFamilyStore((state) => state.currentFamily);\n  const supabase = useMemo(() => createClient(), []);\n  const [persons, setPersons] = useState<Person[]>([]);\n  const [unions, setUnions] = useState<Union[]>([]);\n  const [relationships, setRelationships] = useState<Relationship[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Fetch all data when family changes\n  useEffect(() => {\n    if (currentFamily?.id) {\n      fetchTreeData(currentFamily.id);\n    } else {\n      setPersons([]);\n      setUnions([]);\n      setRelationships([]);\n      setIsLoading(false);\n    }\n  }, [currentFamily?.id]);\n\n  const fetchTreeData = useCallback(async (familyId: string) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // Fetch persons\n      const { data: personsData, error: personsError } = await supabase\n        .from('persons')\n        .select('*')\n        .eq('family_id', familyId)\n        .order('created_at', { ascending: true });\n\n      if (personsError) throw personsError;\n\n      // Fetch unions\n      const { data: unionsData, error: unionsError } = await supabase\n        .from('unions')\n        .select('*')\n        .eq('family_id', familyId);\n\n      if (unionsError) throw unionsError;\n\n      // Fetch union children\n      const { data: childrenData, error: childrenError } = await supabase\n        .from('union_children')\n        .select('union_id, child_id')\n        .in('union_id', (unionsData || []).map((u: any) => u.id));\n\n      if (childrenError) throw childrenError;\n\n      // Fetch relationships\n      const { data: relationshipsData, error: relError } = await supabase\n        .from('relationships')\n        .select('*')\n        .eq('family_id', familyId);\n\n      if (relError) throw relError;\n\n      // Map data\n      const personsList: Person[] = (personsData || []).map((p: any) => ({\n        id: p.id,\n        familyId: p.family_id,\n        firstName: p.first_name,\n        middleNames: p.middle_names,\n        lastName: p.last_name,\n        maidenName: p.maiden_name,\n        nicknames: p.nicknames,\n        birthDate: p.birth_date,\n        birthDateApproximate: p.birth_date_approximate,\n        birthPlace: p.birth_place,\n        deathDate: p.death_date,\n        deathDateApproximate: p.death_date_approximate,\n        deathPlace: p.death_place,\n        gender: p.gender as Gender,\n        isLiving: p.is_living,\n        biography: p.biography,\n        photoUrl: p.photo_url,\n        medicalConditions: p.medical_conditions,\n        linkedUserId: p.linked_user_id,\n        createdAt: p.created_at,\n      }));\n\n      // Group children by union\n      const childrenByUnion = new Map<string, string[]>();\n      (childrenData || []).forEach((c: any) => {\n        const existing = childrenByUnion.get(c.union_id) || [];\n        existing.push(c.child_id);\n        childrenByUnion.set(c.union_id, existing);\n      });\n\n      const unionsList: Union[] = (unionsData || []).map((u: any) => ({\n        id: u.id,\n        familyId: u.family_id,\n        partner1Id: u.partner1_id,\n        partner2Id: u.partner2_id,\n        unionType: u.union_type,\n        startDate: u.start_date,\n        endDate: u.end_date,\n        location: u.location,\n        children: childrenByUnion.get(u.id) || [],\n      }));\n\n      const relationshipsList: Relationship[] = (relationshipsData || []).map((r: any) => ({\n        id: r.id,\n        familyId: r.family_id,\n        person1Id: r.person1_id,\n        person2Id: r.person2_id,\n        relationshipType: r.relationship_type,\n        isBiological: r.is_biological,\n      }));\n\n      setPersons(personsList);\n      setUnions(unionsList);\n      setRelationships(relationshipsList);\n    } catch (err) {\n      console.error('Error fetching tree data:', err);\n      setError('Error loading family tree');\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Convert to GraphData format for the layout engine\n  const graphData: GraphData = useMemo(() => {\n    const graphPersons: GraphPerson[] = persons.map(p => ({\n      id: p.id,\n      firstName: p.firstName,\n      lastName: p.lastName || '',\n      gender: p.gender,\n      birthDate: p.birthDate,\n      birthDateApproximate: p.birthDateApproximate,\n      deathDate: p.deathDate,\n      deathDateApproximate: p.deathDateApproximate,\n      photoUrl: p.photoUrl,\n      isLiving: p.isLiving,\n      medicalConditions: p.medicalConditions,\n    }));\n\n    const graphUnions: GraphUnion[] = unions.map(u => ({\n      id: u.id,\n      partner1Id: u.partner1Id,\n      partner2Id: u.partner2Id || '',\n      unionType: u.unionType as any,\n      startDate: u.startDate,\n      endDate: u.endDate,\n      childrenIds: u.children,\n    }));\n\n    const graphRelationships: GraphRelationship[] = relationships.map(r => ({\n      id: r.id,\n      personId: r.person1Id,\n      relatedPersonId: r.person2Id,\n      type: r.relationshipType === 'parent_child' ? 'parent' : r.relationshipType as any,\n    }));\n\n    return {\n      persons: graphPersons,\n      unions: graphUnions,\n      relationships: graphRelationships,\n    };\n  }, [persons, unions, relationships]);\n\n  // CRUD operations\n  const createPerson = useCallback(async (input: CreatePersonInput): Promise<Person | null> => {\n    if (!currentFamily?.id) return null;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    try {\n      const { data, error } = await supabase\n        .from('persons')\n        .insert({\n          family_id: currentFamily.id,\n          first_name: input.firstName,\n          last_name: input.lastName,\n          gender: input.gender,\n          birth_date: input.birthDate,\n          is_living: input.isLiving ?? true,\n          photo_url: input.photoUrl,\n          created_by: userData.user.id,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      const newPerson: Person = {\n        id: data.id,\n        familyId: data.family_id,\n        firstName: data.first_name,\n        lastName: data.last_name,\n        gender: data.gender as Gender,\n        birthDate: data.birth_date,\n        isLiving: data.is_living,\n        photoUrl: data.photo_url,\n        createdAt: data.created_at,\n      };\n\n      setPersons(prev => [...prev, newPerson]);\n      return newPerson;\n    } catch (err) {\n      console.error('Error creating person:', err);\n      setError('Error creating person');\n      return null;\n    }\n  }, [currentFamily?.id]);\n\n  const updatePerson = useCallback(async (personId: string, updates: Partial<CreatePersonInput>): Promise<boolean> => {\n    try {\n      const updateData: Record<string, any> = {};\n      if (updates.firstName !== undefined) updateData.first_name = updates.firstName;\n      if (updates.lastName !== undefined) updateData.last_name = updates.lastName;\n      if (updates.gender !== undefined) updateData.gender = updates.gender;\n      if (updates.birthDate !== undefined) updateData.birth_date = updates.birthDate;\n      if (updates.isLiving !== undefined) updateData.is_living = updates.isLiving;\n      if (updates.photoUrl !== undefined) updateData.photo_url = updates.photoUrl;\n\n      const { error } = await supabase\n        .from('persons')\n        .update(updateData)\n        .eq('id', personId);\n\n      if (error) throw error;\n\n      // Refresh data\n      if (currentFamily?.id) {\n        await fetchTreeData(currentFamily.id);\n      }\n\n      return true;\n    } catch (err) {\n      console.error('Error updating person:', err);\n      return false;\n    }\n  }, [currentFamily?.id, fetchTreeData]);\n\n  const deletePerson = useCallback(async (personId: string): Promise<boolean> => {\n    try {\n      const { error } = await supabase\n        .from('persons')\n        .delete()\n        .eq('id', personId);\n\n      if (error) throw error;\n\n      setPersons(prev => prev.filter(p => p.id !== personId));\n      return true;\n    } catch (err) {\n      console.error('Error deleting person:', err);\n      return false;\n    }\n  }, []);\n\n  const createUnion = useCallback(async (\n    partner1Id: string,\n    partner2Id: string | null,\n    type: string = 'marriage'\n  ): Promise<Union | null> => {\n    if (!currentFamily?.id) return null;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    try {\n      const { data, error } = await supabase\n        .from('unions')\n        .insert({\n          family_id: currentFamily.id,\n          partner1_id: partner1Id,\n          partner2_id: partner2Id,\n          union_type: type,\n          created_by: userData.user.id,\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n\n      const newUnion: Union = {\n        id: data.id,\n        familyId: data.family_id,\n        partner1Id: data.partner1_id,\n        partner2Id: data.partner2_id,\n        unionType: data.union_type,\n        startDate: data.start_date,\n        endDate: data.end_date,\n        location: data.location,\n        children: [],\n      };\n\n      setUnions(prev => [...prev, newUnion]);\n      return newUnion;\n    } catch (err) {\n      console.error('Error creating union:', err);\n      return null;\n    }\n  }, [currentFamily?.id]);\n\n  const addChildToUnion = useCallback(async (unionId: string, childId: string): Promise<boolean> => {\n    try {\n      const { error } = await supabase\n        .from('union_children')\n        .insert({\n          union_id: unionId,\n          child_id: childId,\n        });\n\n      if (error) throw error;\n\n      // Update local state\n      setUnions(prev => prev.map(u =>\n        u.id === unionId\n          ? { ...u, children: [...u.children, childId] }\n          : u\n      ));\n\n      return true;\n    } catch (err) {\n      console.error('Error adding child to union:', err);\n      return false;\n    }\n  }, []);\n\n  const createRelationship = useCallback(async (\n    person1Id: string,\n    person2Id: string,\n    type: string,\n    isBiological: boolean = true\n  ): Promise<boolean> => {\n    if (!currentFamily?.id) return false;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return false;\n\n    try {\n      const { error } = await supabase\n        .from('relationships')\n        .insert({\n          family_id: currentFamily.id,\n          person1_id: person1Id,\n          person2_id: person2Id,\n          relationship_type: type,\n          is_biological: isBiological,\n          created_by: userData.user.id,\n        });\n\n      if (error) throw error;\n\n      // Refresh data\n      await fetchTreeData(currentFamily.id);\n      return true;\n    } catch (err) {\n      console.error('Error creating relationship:', err);\n      return false;\n    }\n  }, [currentFamily?.id, fetchTreeData]);\n\n  const getPersonById = useCallback((personId: string): Person | undefined => {\n    return persons.find(p => p.id === personId);\n  }, [persons]);\n\n  const refresh = useCallback(async () => {\n    if (currentFamily?.id) {\n      await fetchTreeData(currentFamily.id);\n    }\n  }, [currentFamily?.id, fetchTreeData]);\n\n  // Get root person (first person added or self-marked person)\n  const getRootPerson = useCallback((): Person | null => {\n    if (persons.length === 0) return null;\n    // For now, return the first person created\n    return persons[0];\n  }, [persons]);\n\n  // Find or create a union between two people\n  const findOrCreateUnion = useCallback(async (\n    partner1Id: string,\n    partner2Id: string | null,\n    type: string = 'marriage'\n  ): Promise<string | null> => {\n    // Look for existing union\n    const existingUnion = unions.find(u =>\n      (u.partner1Id === partner1Id && u.partner2Id === partner2Id) ||\n      (u.partner1Id === partner2Id && u.partner2Id === partner1Id)\n    );\n\n    if (existingUnion) {\n      return existingUnion.id;\n    }\n\n    // Create new union\n    const newUnion = await createUnion(partner1Id, partner2Id, type);\n    return newUnion?.id || null;\n  }, [unions, createUnion]);\n\n  // Get parents of a person\n  const getParentsOfPerson = useCallback((personId: string): { fatherId?: string; motherId?: string; unionId?: string } => {\n    // Find union where this person is a child\n    for (const union of unions) {\n      if (union.children.includes(personId)) {\n        const partner1 = persons.find(p => p.id === union.partner1Id);\n        const partner2 = persons.find(p => p.id === union.partner2Id);\n\n        let fatherId: string | undefined;\n        let motherId: string | undefined;\n\n        if (partner1?.gender === 'male') fatherId = partner1.id;\n        else if (partner1?.gender === 'female') motherId = partner1.id;\n\n        if (partner2?.gender === 'male') fatherId = partner2.id;\n        else if (partner2?.gender === 'female') motherId = partner2.id;\n\n        return { fatherId, motherId, unionId: union.id };\n      }\n    }\n    return {};\n  }, [unions, persons]);\n\n  // Get spouse of a person\n  const getSpouseOfPerson = useCallback((personId: string): Person | null => {\n    for (const union of unions) {\n      if (union.partner1Id === personId && union.partner2Id) {\n        return persons.find(p => p.id === union.partner2Id) || null;\n      }\n      if (union.partner2Id === personId) {\n        return persons.find(p => p.id === union.partner1Id) || null;\n      }\n    }\n    return null;\n  }, [unions, persons]);\n\n  // Create person with relationship - the main function for adding family members\n  const createPersonWithRelationship = useCallback(async (\n    input: CreatePersonWithRelationshipInput\n  ): Promise<Person | null> => {\n    if (!currentFamily?.id) return null;\n\n    const { data: userData } = await supabase.auth.getUser();\n    if (!userData.user) return null;\n\n    try {\n      // First, create the person\n      const { data: personData, error: personError } = await supabase\n        .from('persons')\n        .insert({\n          family_id: currentFamily.id,\n          first_name: input.firstName,\n          last_name: input.lastName,\n          gender: input.gender,\n          birth_date: input.birthDate,\n          is_living: input.isLiving ?? true,\n          photo_url: input.photoUrl,\n          medical_conditions: input.medicalConditions || null,\n          created_by: userData.user.id,\n        })\n        .select()\n        .single();\n\n      if (personError) throw personError;\n\n      const newPersonId = personData.id;\n      const relatedToId = input.relatedToPersonId;\n\n      // Now handle the relationship based on type\n      switch (input.relationshipType) {\n        case 'self':\n          // This is the root person, no relationship needed\n          break;\n\n        case 'father':\n        case 'mother': {\n          // Adding a parent to the related person\n          if (!relatedToId) break;\n\n          // Get existing parents of the related person\n          const existingParents = getParentsOfPerson(relatedToId);\n\n          if (existingParents.unionId) {\n            // Union exists, update it to add this parent as the second partner\n            if (input.relationshipType === 'father' && !existingParents.fatherId) {\n              // If partner1 is already the mother, add father as partner2\n              // Otherwise update partner1\n              const currentUnion = unions.find(u => u.id === existingParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', existingParents.unionId);\n              } else {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', existingParents.unionId);\n              }\n            } else if (input.relationshipType === 'mother' && !existingParents.motherId) {\n              const currentUnion = unions.find(u => u.id === existingParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', existingParents.unionId);\n              } else {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', existingParents.unionId);\n              }\n            }\n          } else {\n            // Create new union with new parent and add related person as child\n            // The new parent is always partner1, partner2 will be added later\n            const union = await createUnion(newPersonId, null, 'marriage');\n            if (union) {\n              await addChildToUnion(union.id, relatedToId);\n            }\n          }\n\n          // Create parent-child relationship\n          await createRelationship(newPersonId, relatedToId, 'parent_child', true);\n          break;\n        }\n\n        case 'spouse': {\n          // Adding a spouse to the related person\n          if (!relatedToId) break;\n\n          // Create or find union between them\n          await findOrCreateUnion(relatedToId, newPersonId, 'marriage');\n\n          // Create spouse relationship\n          await createRelationship(relatedToId, newPersonId, 'spouse', false);\n          break;\n        }\n\n        case 'son':\n        case 'daughter': {\n          // Adding a child to the related person\n          if (!relatedToId) break;\n\n          // Find or create union for the parent\n          const spouse = getSpouseOfPerson(relatedToId);\n          let unionId: string | null = null;\n\n          if (spouse) {\n            // Find existing union with spouse\n            unionId = await findOrCreateUnion(relatedToId, spouse.id, 'marriage');\n          } else {\n            // Create single-parent union\n            const union = await createUnion(relatedToId, null, 'other');\n            unionId = union?.id || null;\n          }\n\n          if (unionId) {\n            await addChildToUnion(unionId, newPersonId);\n          }\n\n          // Create parent-child relationship\n          await createRelationship(relatedToId, newPersonId, 'parent_child', true);\n          break;\n        }\n\n        case 'brother':\n        case 'sister': {\n          // Adding a sibling to the related person\n          if (!relatedToId) break;\n\n          // Find the parents union of the related person\n          const existingParents = getParentsOfPerson(relatedToId);\n\n          if (existingParents.unionId) {\n            // Add to same union as sibling (they share the same parents)\n            await addChildToUnion(existingParents.unionId, newPersonId);\n          }\n          // If no parents exist yet, we just create the sibling relationship\n          // Parents can be added later, and both siblings will be linked to them\n\n          // Create sibling relationship\n          await createRelationship(relatedToId, newPersonId, 'sibling', true);\n          break;\n        }\n\n        case 'grandfather_paternal':\n        case 'grandmother_paternal': {\n          // Adding paternal grandparent\n          if (!relatedToId) break;\n\n          const parents = getParentsOfPerson(relatedToId);\n          if (parents.fatherId) {\n            // Add as parent of the father\n            const fatherParents = getParentsOfPerson(parents.fatherId);\n\n            if (fatherParents.unionId) {\n              // Update existing grandparents union - add as second partner\n              const currentUnion = unions.find(u => u.id === fatherParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', fatherParents.unionId);\n              } else if (!currentUnion?.partner1Id) {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', fatherParents.unionId);\n              }\n            } else {\n              // Create new union and add father as child\n              const union = await createUnion(newPersonId, null, 'marriage');\n              if (union) {\n                await addChildToUnion(union.id, parents.fatherId);\n              }\n            }\n\n            await createRelationship(newPersonId, parents.fatherId, 'parent_child', true);\n          }\n          break;\n        }\n\n        case 'grandfather_maternal':\n        case 'grandmother_maternal': {\n          // Adding maternal grandparent\n          if (!relatedToId) break;\n\n          const parents = getParentsOfPerson(relatedToId);\n          if (parents.motherId) {\n            // Add as parent of the mother\n            const motherParents = getParentsOfPerson(parents.motherId);\n\n            if (motherParents.unionId) {\n              // Update existing grandparents union - add as second partner\n              const currentUnion = unions.find(u => u.id === motherParents.unionId);\n              if (currentUnion?.partner1Id && !currentUnion?.partner2Id) {\n                await supabase.from('unions').update({ partner2_id: newPersonId }).eq('id', motherParents.unionId);\n              } else if (!currentUnion?.partner1Id) {\n                await supabase.from('unions').update({ partner1_id: newPersonId }).eq('id', motherParents.unionId);\n              }\n            } else {\n              // Create new union and add mother as child\n              const union = await createUnion(newPersonId, null, 'marriage');\n              if (union) {\n                await addChildToUnion(union.id, parents.motherId);\n              }\n            }\n\n            await createRelationship(newPersonId, parents.motherId, 'parent_child', true);\n          }\n          break;\n        }\n\n        case 'uncle':\n        case 'aunt': {\n          // Adding uncle/aunt (sibling of parent)\n          if (!relatedToId) break;\n\n          const parents = getParentsOfPerson(relatedToId);\n          const parentId = input.gender === 'male'\n            ? (parents.fatherId || parents.motherId)\n            : (parents.motherId || parents.fatherId);\n\n          if (parentId) {\n            // Find grandparents union\n            const grandparents = getParentsOfPerson(parentId);\n\n            if (grandparents.unionId) {\n              // Add new person as child of grandparents\n              await addChildToUnion(grandparents.unionId, newPersonId);\n              await createRelationship(parentId, newPersonId, 'sibling', true);\n            }\n          }\n          break;\n        }\n\n        case 'cousin': {\n          // Adding a cousin is complex - need to find uncle/aunt first\n          // For now, just add as a person without automatic relationship\n          console.log('Cousin relationship requires manual setup');\n          break;\n        }\n      }\n\n      // Refresh all data\n      await fetchTreeData(currentFamily.id);\n\n      // Return the created person (constructed from the insert response)\n      const createdPerson: Person = {\n        id: personData.id,\n        familyId: personData.family_id,\n        firstName: personData.first_name,\n        lastName: personData.last_name,\n        gender: personData.gender as Gender,\n        birthDate: personData.birth_date,\n        isLiving: personData.is_living,\n        photoUrl: personData.photo_url,\n        medicalConditions: personData.medical_conditions,\n        createdAt: personData.created_at,\n      };\n\n      return createdPerson;\n    } catch (err) {\n      console.error('Error creating person with relationship:', err);\n      setError('Error creating person');\n      return null;\n    }\n  }, [\n    currentFamily?.id,\n    supabase,\n    createUnion,\n    addChildToUnion,\n    createRelationship,\n    getParentsOfPerson,\n    getSpouseOfPerson,\n    findOrCreateUnion,\n    fetchTreeData,\n    persons,\n  ]);\n\n  // Calculate the relationship role of a person relative to the root person\n  const getPersonRole = useCallback((personId: string): string | null => {\n    const root = getRootPerson();\n    if (!root) return null;\n    if (personId === root.id) return 'Me';\n\n    const person = persons.find(p => p.id === personId);\n    if (!person) return null;\n\n    // Get parents of root person\n    const rootParents = getParentsOfPerson(root.id);\n\n    // Check if person is parent of root\n    if (rootParents.fatherId === personId) return 'Father';\n    if (rootParents.motherId === personId) return 'Mother';\n\n    // Check if person is spouse of root\n    const rootSpouse = getSpouseOfPerson(root.id);\n    if (rootSpouse?.id === personId) {\n      return person.gender === 'male' ? 'Husband' : 'Wife';\n    }\n\n    // Check if person is child of root (root is parent in a union)\n    for (const union of unions) {\n      if (union.partner1Id === root.id || union.partner2Id === root.id) {\n        if (union.children.includes(personId)) {\n          return person.gender === 'male' ? 'Son' : 'Daughter';\n        }\n      }\n    }\n\n    // Check if person is sibling (shares same parents as root)\n    if (rootParents.unionId) {\n      const rootUnion = unions.find(u => u.id === rootParents.unionId);\n      if (rootUnion && rootUnion.children.includes(personId)) {\n        return person.gender === 'male' ? 'Brother' : 'Sister';\n      }\n    }\n\n    // Also check sibling relationship in relationships table\n    const siblingRelationship = relationships.find(r =>\n    (r.relationshipType === 'sibling' &&\n      ((r.person1Id === root.id && r.person2Id === personId) ||\n        (r.person1Id === personId && r.person2Id === root.id)))\n    );\n    if (siblingRelationship) {\n      return person.gender === 'male' ? 'Brother' : 'Sister';\n    }\n\n    // Check if they share at least one parent (alternative sibling check)\n    const personParents = getParentsOfPerson(personId);\n    if ((rootParents.fatherId && rootParents.fatherId === personParents.fatherId) ||\n      (rootParents.motherId && rootParents.motherId === personParents.motherId)) {\n      return person.gender === 'male' ? 'Brother' : 'Sister';\n    }\n\n    // Check if person is grandparent\n    if (rootParents.fatherId) {\n      const fatherParents = getParentsOfPerson(rootParents.fatherId);\n      if (fatherParents.fatherId === personId) return 'Paternal Grandfather';\n      if (fatherParents.motherId === personId) return 'Paternal Grandmother';\n    }\n    if (rootParents.motherId) {\n      const motherParents = getParentsOfPerson(rootParents.motherId);\n      if (motherParents.fatherId === personId) return 'Maternal Grandfather';\n      if (motherParents.motherId === personId) return 'Maternal Grandmother';\n    }\n\n    // Check if person is uncle/aunt (sibling of root's parents)\n    if (rootParents.fatherId) {\n      const fatherParents = getParentsOfPerson(rootParents.fatherId);\n      if (fatherParents.unionId) {\n        const fatherSiblingsUnion = unions.find(u => u.id === fatherParents.unionId);\n        if (fatherSiblingsUnion) {\n          // Filter out the root's father himself from the siblings\n          const siblingsOfFather = fatherSiblingsUnion.children.filter(id => id !== rootParents.fatherId);\n          if (siblingsOfFather.includes(personId)) {\n            return person.gender === 'male' ? 'Uncle' : 'Aunt';\n          }\n        }\n      }\n    }\n    if (rootParents.motherId) {\n      const motherParents = getParentsOfPerson(rootParents.motherId);\n      if (motherParents.unionId) {\n        const motherSiblingsUnion = unions.find(u => u.id === motherParents.unionId);\n        if (motherSiblingsUnion) {\n          // Filter out the root's mother herself from the siblings\n          const siblingsOfMother = motherSiblingsUnion.children.filter(id => id !== rootParents.motherId);\n          if (siblingsOfMother.includes(personId)) {\n            return person.gender === 'male' ? 'Uncle' : 'Aunt';\n          }\n        }\n      }\n    }\n\n    // Check if person is grandchild\n    for (const union of unions) {\n      if (union.partner1Id === root.id || union.partner2Id === root.id) {\n        for (const childId of union.children) {\n          // Check if this child has children that include the person\n          for (const childUnion of unions) {\n            if (childUnion.partner1Id === childId || childUnion.partner2Id === childId) {\n              if (childUnion.children.includes(personId)) {\n                return person.gender === 'male' ? 'Grandson' : 'Granddaughter';\n              }\n            }\n          }\n        }\n      }\n    }\n\n    // Check if person is nephew/niece (child of sibling)\n    if (rootParents.unionId) {\n      const rootUnion = unions.find(u => u.id === rootParents.unionId);\n      if (rootUnion) {\n        for (const siblingId of rootUnion.children) {\n          if (siblingId === root.id) continue; // Skip the root person themselves\n          // Check if person is child of this sibling\n          for (const siblingUnion of unions) {\n            if (siblingUnion.partner1Id === siblingId || siblingUnion.partner2Id === siblingId) {\n              if (siblingUnion.children.includes(personId)) {\n                return person.gender === 'male' ? 'Nephew' : 'Niece';\n              }\n            }\n          }\n        }\n      }\n    }\n\n    // Check if person is cousin (child of uncle/aunt)\n    // First get uncles/aunts\n    const unclesAunts: string[] = [];\n    if (rootParents.fatherId) {\n      const fatherParents = getParentsOfPerson(rootParents.fatherId);\n      if (fatherParents.unionId) {\n        const fatherSiblingsUnion = unions.find(u => u.id === fatherParents.unionId);\n        if (fatherSiblingsUnion) {\n          unclesAunts.push(...fatherSiblingsUnion.children.filter(id => id !== rootParents.fatherId));\n        }\n      }\n    }\n    if (rootParents.motherId) {\n      const motherParents = getParentsOfPerson(rootParents.motherId);\n      if (motherParents.unionId) {\n        const motherSiblingsUnion = unions.find(u => u.id === motherParents.unionId);\n        if (motherSiblingsUnion) {\n          unclesAunts.push(...motherSiblingsUnion.children.filter(id => id !== rootParents.motherId));\n        }\n      }\n    }\n\n    // Check if person is child of any uncle/aunt\n    for (const uncleAuntId of unclesAunts) {\n      for (const uncleAuntUnion of unions) {\n        if (uncleAuntUnion.partner1Id === uncleAuntId || uncleAuntUnion.partner2Id === uncleAuntId) {\n          if (uncleAuntUnion.children.includes(personId)) {\n            return 'Cousin';\n          }\n        }\n      }\n    }\n\n    return 'Relative';\n  }, [persons, unions, relationships, getRootPerson, getParentsOfPerson, getSpouseOfPerson]);\n\n  return {\n    persons,\n    unions,\n    relationships,\n    graphData,\n    isLoading,\n    error,\n    createPerson,\n    createPersonWithRelationship,\n    updatePerson,\n    deletePerson,\n    createUnion,\n    addChildToUnion,\n    createRelationship,\n    getPersonById,\n    getRootPerson,\n    getParentsOfPerson,\n    getSpouseOfPerson,\n    getPersonRole,\n    refresh,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 808, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/hooks/useLocationTracking.ts"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback, useMemo } from 'react';\nimport { createClient } from '@/lib/supabase';\nimport { useFamily } from './useFamily';\n\nexport interface LocationData {\n  latitude: number;\n  longitude: number;\n  accuracy?: number;\n  altitude?: number;\n  heading?: number;\n  speed?: number;\n  address?: string;\n  city?: string;\n  country?: string;\n}\n\nexport interface FamilyMemberLocation {\n  userId: string;\n  personId: string;\n  firstName: string;\n  lastName: string;\n  photoUrl: string | null;\n  latitude: number;\n  longitude: number;\n  accuracy: number | null;\n  address: string | null;\n  city: string | null;\n  batteryLevel: number | null;\n  isCharging: boolean;\n  lastUpdatedAt: string;\n  isOnline: boolean;\n}\n\nexport interface LocationSharingSettings {\n  shareLocation: boolean;\n  shareWithAll: boolean;\n  sharePreciseLocation: boolean;\n  updateFrequency: 'realtime' | 'hourly' | 'daily' | 'manual';\n}\n\ntype PermissionStatus = 'prompt' | 'granted' | 'denied' | 'unavailable';\n\nexport function useLocationTracking() {\n  const supabase = useMemo(() => createClient(), []);\n  const { currentFamily } = useFamily();\n\n  const [permissionStatus, setPermissionStatus] = useState<PermissionStatus>('prompt');\n  const [isTracking, setIsTracking] = useState(false);\n  const [currentLocation, setCurrentLocation] = useState<LocationData | null>(null);\n  const [familyLocations, setFamilyLocations] = useState<FamilyMemberLocation[]>([]);\n  const [settings, setSettings] = useState<LocationSharingSettings>({\n    shareLocation: false,\n    shareWithAll: true,\n    sharePreciseLocation: true,\n    updateFrequency: 'realtime',\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  // Check if geolocation is available\n  const isGeolocationAvailable = typeof navigator !== 'undefined' && 'geolocation' in navigator;\n\n  // Check permission status\n  const checkPermission = useCallback(async () => {\n    if (!isGeolocationAvailable) {\n      setPermissionStatus('unavailable');\n      return 'unavailable';\n    }\n\n    try {\n      const result = await navigator.permissions.query({ name: 'geolocation' });\n      setPermissionStatus(result.state as PermissionStatus);\n\n      result.onchange = () => {\n        setPermissionStatus(result.state as PermissionStatus);\n      };\n\n      return result.state as PermissionStatus;\n    } catch {\n      // Some browsers don't support permissions API\n      setPermissionStatus('prompt');\n      return 'prompt';\n    }\n  }, [isGeolocationAvailable]);\n\n  // Request location permission\n  const requestPermission = useCallback(async (): Promise<boolean> => {\n    if (!isGeolocationAvailable) {\n      setError('Geolocation not available on this device');\n      return false;\n    }\n\n    return new Promise((resolve) => {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          setPermissionStatus('granted');\n          setCurrentLocation({\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n            accuracy: position.coords.accuracy,\n            altitude: position.coords.altitude || undefined,\n            heading: position.coords.heading || undefined,\n            speed: position.coords.speed || undefined,\n          });\n          resolve(true);\n        },\n        (error) => {\n          if (error.code === error.PERMISSION_DENIED) {\n            setPermissionStatus('denied');\n            setError('Location permission denied');\n          } else {\n            setError('Error getting location');\n          }\n          resolve(false);\n        },\n        {\n          enableHighAccuracy: true,\n          timeout: 10000,\n          maximumAge: 0,\n        }\n      );\n    });\n  }, [isGeolocationAvailable]);\n\n  // Reverse geocode to get address\n  const reverseGeocode = useCallback(async (lat: number, lng: number): Promise<{ address?: string; city?: string; country?: string }> => {\n    try {\n      const response = await fetch(\n        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`,\n        {\n          headers: {\n            'User-Agent': 'KinTree Family App',\n          },\n        }\n      );\n\n      if (!response.ok) return {};\n\n      const data = await response.json();\n      const addr = data.address || {};\n\n      return {\n        address: data.display_name?.split(',').slice(0, 2).join(',') || undefined,\n        city: addr.city || addr.town || addr.village || addr.municipality || undefined,\n        country: addr.country || undefined,\n      };\n    } catch {\n      return {};\n    }\n  }, []);\n\n  // Update location in database\n  const updateLocation = useCallback(async (location: LocationData) => {\n    if (!currentFamily?.id) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      // Get address if not provided\n      let locationWithAddress = { ...location };\n      if (!location.address) {\n        const geoData = await reverseGeocode(location.latitude, location.longitude);\n        locationWithAddress = { ...location, ...geoData };\n      }\n\n      // Get battery info if available\n      let batteryLevel: number | undefined;\n      let isCharging: boolean | undefined;\n\n      if ('getBattery' in navigator) {\n        try {\n          const battery = await (navigator as any).getBattery();\n          batteryLevel = Math.round(battery.level * 100);\n          isCharging = battery.charging;\n        } catch {\n          // Battery API not available\n        }\n      }\n\n      const { error: rpcError } = await supabase.rpc('update_user_location', {\n        p_family_id: currentFamily.id,\n        p_latitude: locationWithAddress.latitude,\n        p_longitude: locationWithAddress.longitude,\n        p_accuracy: locationWithAddress.accuracy || null,\n        p_altitude: locationWithAddress.altitude || null,\n        p_heading: locationWithAddress.heading || null,\n        p_speed: locationWithAddress.speed || null,\n        p_address: locationWithAddress.address || null,\n        p_city: locationWithAddress.city || null,\n        p_country: locationWithAddress.country || null,\n        p_battery_level: batteryLevel || null,\n        p_is_charging: isCharging || null,\n      });\n\n      if (rpcError) {\n        setError('Error updating location');\n        return;\n      }\n\n      setCurrentLocation(locationWithAddress);\n      setError(null);\n    } catch (err) {\n      setError('Error updating location');\n    }\n  }, [currentFamily?.id, supabase, reverseGeocode]);\n\n  // Start tracking location\n  const startTracking = useCallback(() => {\n    if (!isGeolocationAvailable || permissionStatus !== 'granted') return () => { };\n\n    let currentWatchId: number | null = null;\n    let usingHighAccuracy = true;\n\n    const handlePosition = (position: GeolocationPosition) => {\n      const location: LocationData = {\n        latitude: position.coords.latitude,\n        longitude: position.coords.longitude,\n        accuracy: position.coords.accuracy,\n        altitude: position.coords.altitude || undefined,\n        heading: position.coords.heading || undefined,\n        speed: position.coords.speed || undefined,\n      };\n\n      updateLocation(location);\n    };\n\n    const handleError = (error: GeolocationPositionError) => {\n      // If high accuracy fails, switch to low accuracy\n      if (usingHighAccuracy && (error.code === error.TIMEOUT || error.code === error.POSITION_UNAVAILABLE)) {\n        usingHighAccuracy = false;\n        if (currentWatchId !== null) navigator.geolocation.clearWatch(currentWatchId);\n\n        currentWatchId = navigator.geolocation.watchPosition(\n          handlePosition,\n          (fallbackError) => {\n            setError(`Error tracking location: ${fallbackError.message}`);\n          },\n          {\n            enableHighAccuracy: false,\n            timeout: 30000,\n            maximumAge: 60000,\n          }\n        );\n        return;\n      }\n\n      setError(`Error tracking location: ${error.message}`);\n    };\n\n    currentWatchId = navigator.geolocation.watchPosition(\n      handlePosition,\n      handleError,\n      {\n        enableHighAccuracy: true,\n        timeout: 10000, // 10s for high accuracy\n        maximumAge: 60000, // Cache for 1 minute\n      }\n    );\n\n    return () => {\n      if (currentWatchId !== null) navigator.geolocation.clearWatch(currentWatchId);\n    };\n  }, [isGeolocationAvailable, permissionStatus, updateLocation]);\n\n  // Fetch family members' locations\n  const fetchFamilyLocations = useCallback(async () => {\n    if (!currentFamily?.id) {\n      setFamilyLocations([]);\n      return;\n    }\n\n    try {\n      const { data, error: rpcError } = await supabase.rpc('get_family_locations', {\n        p_family_id: currentFamily.id,\n      });\n\n      if (rpcError) {\n        setError('Error fetching family locations');\n        setFamilyLocations([]);\n        return;\n      }\n\n      const locations: FamilyMemberLocation[] = (data || []).map((loc: any) => ({\n        userId: loc.user_id,\n        personId: loc.person_id,\n        firstName: loc.first_name,\n        lastName: loc.last_name,\n        photoUrl: loc.photo_url,\n        latitude: parseFloat(loc.latitude),\n        longitude: parseFloat(loc.longitude),\n        accuracy: loc.accuracy ? parseFloat(loc.accuracy) : null,\n        address: loc.address,\n        city: loc.city,\n        batteryLevel: loc.battery_level,\n        isCharging: loc.is_charging || false,\n        lastUpdatedAt: loc.last_updated_at,\n        isOnline: loc.is_online,\n      }));\n\n      setFamilyLocations(locations);\n      setError(null);\n    } catch (err) {\n      setError('Error fetching family locations');\n      setFamilyLocations([]);\n    }\n  }, [currentFamily?.id, supabase]);\n\n  // Load settings\n  const loadSettings = useCallback(async () => {\n    if (!currentFamily?.id) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      const { data, error: queryError } = await supabase\n        .from('location_sharing_settings')\n        .select('*')\n        .eq('user_id', user.id)\n        .eq('family_id', currentFamily.id)\n        .maybeSingle();\n\n      if (queryError) {\n        setError('Error loading location settings');\n        return;\n      }\n\n      if (data) {\n        setSettings({\n          shareLocation: data.share_location,\n          shareWithAll: data.share_with_all,\n          sharePreciseLocation: data.share_precise_location,\n          updateFrequency: data.update_frequency,\n        });\n      }\n    } catch (err) {\n      setError('Error loading location settings');\n    }\n  }, [currentFamily?.id, supabase]);\n\n  // Save settings\n  const saveSettings = useCallback(async (newSettings: Partial<LocationSharingSettings>) => {\n    if (!currentFamily?.id) return;\n\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      if (!user) return;\n\n      const updatedSettings = { ...settings, ...newSettings };\n\n      const { error: upsertError } = await supabase\n        .from('location_sharing_settings')\n        .upsert({\n          user_id: user.id,\n          family_id: currentFamily.id,\n          share_location: updatedSettings.shareLocation,\n          share_with_all: updatedSettings.shareWithAll,\n          share_precise_location: updatedSettings.sharePreciseLocation,\n          update_frequency: updatedSettings.updateFrequency,\n          updated_at: new Date().toISOString(),\n        }, {\n          onConflict: 'user_id,family_id',\n        });\n\n      if (upsertError) {\n        setError('Error saving settings');\n        return;\n      }\n\n      setSettings(updatedSettings);\n      setError(null);\n    } catch (err) {\n      setError('Error saving settings');\n    }\n  }, [currentFamily?.id, supabase, settings]);\n\n  // Enable location sharing\n  const enableLocationSharing = useCallback(async () => {\n    try {\n      const hasPermission = await requestPermission();\n      if (hasPermission) {\n        await saveSettings({ shareLocation: true });\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error('Error enabling location sharing:', error);\n      return false;\n    }\n  }, [requestPermission, saveSettings]);\n\n  // Disable location sharing\n  const disableLocationSharing = useCallback(async () => {\n    await saveSettings({ shareLocation: false });\n    setIsTracking(false);\n  }, [saveSettings]);\n\n  // Initialize on mount\n  useEffect(() => {\n    const init = async () => {\n      setIsLoading(true);\n      await checkPermission();\n      await loadSettings();\n      await fetchFamilyLocations();\n      setIsLoading(false);\n    };\n\n    init();\n  }, [checkPermission, loadSettings, fetchFamilyLocations]);\n\n  // Auto-start tracking if enabled\n  // Auto-start tracking if enabled\n  useEffect(() => {\n    if (settings.shareLocation && permissionStatus === 'granted') {\n      setIsTracking(true);\n      const cleanup = startTracking();\n      return () => {\n        if (cleanup) cleanup();\n        setIsTracking(false);\n      };\n    } else {\n      setIsTracking(false);\n    }\n  }, [settings.shareLocation, permissionStatus, startTracking]);\n\n  // Refresh family locations periodically\n  useEffect(() => {\n    if (!currentFamily?.id) return;\n\n    const interval = setInterval(fetchFamilyLocations, 30000); // Every 30 seconds\n    return () => clearInterval(interval);\n  }, [currentFamily?.id, fetchFamilyLocations]);\n\n  return {\n    // State\n    permissionStatus,\n    isTracking,\n    currentLocation,\n    familyLocations,\n    settings,\n    isLoading,\n    error,\n    isGeolocationAvailable,\n\n    // Actions\n    requestPermission,\n    enableLocationSharing,\n    disableLocationSharing,\n    saveSettings,\n    refreshLocations: fetchFamilyLocations,\n    updateLocationManually: updateLocation,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1211, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/app/%28dashboard%29/security/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useMemo } from 'react';\nimport Link from 'next/link';\nimport dynamic from 'next/dynamic';\nimport {\n  Container,\n  Card,\n  CardHeader,\n  CardContent,\n  Button,\n  Avatar,\n  Badge,\n  Tabs,\n  TabList,\n  TabTrigger,\n  TabContent,\n  Skeleton,\n} from '@kintree/ui';\nimport { useFamilyTree } from '@/hooks/useFamilyTree';\nimport { useLocationTracking } from '@/hooks/useLocationTracking';\n\n// Dynamically import components\nconst FamilyMap = dynamic(() => import('@/components/FamilyMap'), {\n  ssr: false,\n  loading: () => (\n    <div className=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-neutral-50 to-primary-50/30\">\n      <div className=\"text-center\">\n        <div className=\"w-12 h-12 mx-auto mb-4 rounded-full border-4 border-primary-200 border-t-primary-500 animate-spin\" />\n        <p className=\"text-neutral-500\">Loading map...</p>\n      </div>\n    </div>\n  ),\n});\n\nconst LocationPermissionModal = dynamic(() => import('@/components/LocationPermissionModal'), {\n  ssr: false,\n});\n\ninterface FamilyMemberDisplay {\n  id: string;\n  name: string;\n  photoUrl: string | null;\n  status: 'online' | 'away' | 'offline';\n  lastSeen: string | null;\n  location: { lat: number; lng: number; address: string } | null;\n  batteryLevel: number | null;\n  linkedUserId: string | null;\n}\n\nexport default function SecurityPage() {\n  const [activeTab, setActiveTab] = useState('map');\n  const [selectedMember, setSelectedMember] = useState<string | null>(null);\n  const [showPermissionModal, setShowPermissionModal] = useState(false);\n\n  const { persons, isLoading: personsLoading } = useFamilyTree();\n  const {\n    familyLocations,\n    settings,\n    permissionStatus,\n    isTracking,\n    enableLocationSharing,\n    disableLocationSharing,\n    isLoading: locationLoading,\n  } = useLocationTracking();\n\n  // Combine persons data with real location data\n  const familyMembersWithLocation: FamilyMemberDisplay[] = useMemo(() => {\n    const matchedUserIds = new Set<string>();\n\n    const members: FamilyMemberDisplay[] = persons.map((person) => {\n      // Find real location data for this person\n      const locationData = familyLocations.find((loc) => {\n        if (loc.personId === person.id) return true;\n        if (person.linkedUserId && loc.userId === person.linkedUserId) return true;\n\n        // Fuzzy match fallback: link by first name if explicitly missing\n        const pFirst = (person.firstName || '').trim().toLowerCase();\n        const lFirst = (loc.firstName || '').trim().toLowerCase();\n        if (pFirst && lFirst && pFirst.length >= 2 && lFirst.length >= 2) {\n          if (pFirst === lFirst || pFirst.includes(lFirst) || lFirst.includes(pFirst)) {\n            return true;\n          }\n        }\n        return false;\n      });\n\n      if (locationData) {\n        matchedUserIds.add(locationData.userId);\n        // Has real location data\n        const now = new Date();\n        const lastUpdate = new Date(locationData.lastUpdatedAt);\n        const minutesSinceUpdate = (now.getTime() - lastUpdate.getTime()) / 60000;\n\n        let status: 'online' | 'away' | 'offline' = 'offline';\n        if (minutesSinceUpdate < 5) {\n          status = 'online';\n        } else if (minutesSinceUpdate < 30) {\n          status = 'away';\n        }\n\n        return {\n          id: person.id,\n          name: `${person.firstName} ${person.lastName || ''}`.trim(),\n          photoUrl: person.photoUrl || locationData.photoUrl,\n          status,\n          lastSeen: locationData.lastUpdatedAt,\n          location: {\n            lat: locationData.latitude,\n            lng: locationData.longitude,\n            address: locationData.address || locationData.city || 'Unknown location',\n          },\n          batteryLevel: locationData.batteryLevel,\n          linkedUserId: locationData.userId,\n        };\n      }\n\n      // No location data - check if has linked user\n      return {\n        id: person.id,\n        name: `${person.firstName} ${person.lastName || ''}`.trim(),\n        photoUrl: person.photoUrl || null,\n        status: 'offline' as const,\n        lastSeen: null,\n        location: null,\n        batteryLevel: null,\n        linkedUserId: person.linkedUserId || null,\n      };\n    });\n\n    // Add locations from users who are sharing but not yet linked to a person in the tree\n    familyLocations.forEach((loc) => {\n      if (!matchedUserIds.has(loc.userId)) {\n        const now = new Date();\n        const lastUpdate = new Date(loc.lastUpdatedAt);\n        const minutesSinceUpdate = (now.getTime() - lastUpdate.getTime()) / 60000;\n\n        let status: 'online' | 'away' | 'offline' = 'offline';\n        if (minutesSinceUpdate < 5) status = 'online';\n        else if (minutesSinceUpdate < 30) status = 'away';\n\n        members.push({\n          id: `unlinked-${loc.userId}`,\n          name: `${loc.firstName || ''} ${loc.lastName || ''}`.trim() || 'Me',\n          photoUrl: loc.photoUrl,\n          status,\n          lastSeen: loc.lastUpdatedAt,\n          location: {\n            lat: loc.latitude,\n            lng: loc.longitude,\n            address: loc.address || loc.city || 'Unknown location',\n          },\n          batteryLevel: loc.batteryLevel,\n          linkedUserId: loc.userId,\n        });\n      }\n    });\n\n    return members;\n  }, [persons, familyLocations]);\n\n  const activeMembersCount = familyMembersWithLocation.filter(m => m.status !== 'offline').length;\n  const membersWithLocationCount = familyMembersWithLocation.filter(m => m.location !== null).length;\n\n  const isLoading = personsLoading || locationLoading;\n\n  if (isLoading) {\n    return (\n      <Container size=\"full\" padding={false}>\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6\">\n          <div>\n            <Skeleton width={200} height={32} />\n            <Skeleton width={300} height={20} className=\"mt-2\" />\n          </div>\n        </div>\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n          <div className=\"lg:col-span-1\">\n            <Skeleton height={300} className=\"rounded-2xl\" />\n          </div>\n          <div className=\"lg:col-span-3\">\n            <Skeleton height={600} className=\"rounded-2xl\" />\n          </div>\n        </div>\n      </Container>\n    );\n  }\n\n  return (\n    <Container size=\"full\" padding={false}>\n      {/* Header with gradient text */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gradient-primary\">Family Security</h1>\n          <p className=\"text-neutral-500 mt-1\">Location tracking and safety zones</p>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          {/* Location sharing toggle */}\n          {permissionStatus === 'granted' ? (\n            <Button\n              variant={settings.shareLocation ? 'primary' : 'outline'}\n              leftIcon={<LocationIcon />}\n              onClick={() => settings.shareLocation ? disableLocationSharing() : enableLocationSharing()}\n            >\n              {settings.shareLocation ? 'Sharing' : 'Share'}\n            </Button>\n          ) : (\n            <Button\n              variant=\"primary\"\n              leftIcon={<LocationIcon />}\n              onClick={() => setShowPermissionModal(true)}\n            >\n              Enable Location\n            </Button>\n          )}\n          <Link href=\"/security/zones\">\n            <Button variant=\"outline\" leftIcon={<ZoneIcon />}>\n              Zones\n            </Button>\n          </Link>\n          <Link href=\"/security/history\">\n            <Button variant=\"outline\" leftIcon={<HistoryIcon />}>\n              History\n            </Button>\n          </Link>\n        </div>\n      </div>\n\n      {/* Tracking status banner */}\n      {isTracking && (\n        <div className=\"mb-4 p-3 rounded-xl bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 flex items-center gap-3\">\n          <div className=\"w-3 h-3 rounded-full bg-green-500 animate-pulse\" />\n          <p className=\"text-sm text-green-700\">\n            Your location is being shared with your family\n          </p>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={disableLocationSharing}\n            className=\"ml-auto text-green-600 hover:text-green-700\"\n          >\n            Disable\n          </Button>\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        {/* Family Members Panel */}\n        <div className=\"lg:col-span-1 space-y-4\">\n          <Card padding=\"md\" className=\"hover-lift\">\n            <CardHeader\n              title=\"Family Members\"\n              subtitle={`${familyMembersWithLocation.length} members  ${membersWithLocationCount} with location`}\n            />\n            <CardContent>\n              {familyMembersWithLocation.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center\">\n                    <UsersIcon className=\"w-8 h-8 text-primary-500\" />\n                  </div>\n                  <p className=\"text-neutral-500 text-sm mb-3\">No family members yet.</p>\n                  <Link href=\"/tree\">\n                    <Button variant=\"outline\" size=\"sm\">\n                      Add members\n                    </Button>\n                  </Link>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {familyMembersWithLocation.map((member, index) => (\n                    <button\n                      key={member.id}\n                      onClick={() => setSelectedMember(member.id)}\n                      className={`w-full flex items-center gap-3 p-3 rounded-xl transition-all animate-slide-up ${selectedMember === member.id\n                        ? 'bg-gradient-to-r from-primary-50 to-secondary-50 border border-primary-200 shadow-sm'\n                        : 'hover:bg-neutral-50 border border-transparent'\n                        }`}\n                      style={{ animationDelay: `${index * 50}ms` }}\n                    >\n                      <div className=\"relative\">\n                        <Avatar name={member.name} size=\"md\" ringColor={selectedMember === member.id ? 'primary' : undefined} />\n                        <span\n                          className={`absolute bottom-0 right-0 w-3.5 h-3.5 rounded-full border-2 border-white ${member.status === 'online'\n                            ? 'bg-gradient-to-br from-green-400 to-emerald-500 shadow-sm shadow-green-300'\n                            : member.status === 'away'\n                              ? 'bg-gradient-to-br from-amber-400 to-orange-500 shadow-sm shadow-amber-300'\n                              : 'bg-neutral-300'\n                            }`}\n                        />\n                      </div>\n                      <div className=\"flex-1 text-left min-w-0\">\n                        <p className=\"font-medium text-neutral-900 truncate\">{member.name}</p>\n                        <p className=\"text-xs text-neutral-500 truncate\">\n                          {member.location?.address || (member.linkedUserId ? 'Location not shared' : 'No linked account')}\n                        </p>\n                      </div>\n                      <div className=\"flex flex-col items-end\">\n                        {member.batteryLevel !== null ? (\n                          <BatteryIndicator level={member.batteryLevel} />\n                        ) : (\n                          <span className=\"text-xs text-neutral-300\">--</span>\n                        )}\n                        <span className=\"text-xs text-neutral-400 mt-1\">\n                          {member.lastSeen ? formatLastSeen(member.lastSeen) : 'Never'}\n                        </span>\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Quick Stats with glassmorphism */}\n          <Card padding=\"md\" variant=\"glass\" className=\"hover-lift\">\n            <CardHeader title=\"Security Status\" />\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between p-3 rounded-xl bg-gradient-to-r from-green-50 to-emerald-50 border border-green-100\">\n                  <span className=\"text-neutral-700 font-medium\">All safe</span>\n                  <Badge variant=\"success\" glow>\n                    <CheckIcon className=\"w-3 h-3 mr-1\" />\n                    OK\n                  </Badge>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-neutral-600\">Active members</span>\n                  <span className=\"font-bold text-primary-600\">{activeMembersCount}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-neutral-600\">Sharing location</span>\n                  <span className=\"font-bold text-neutral-800\">{membersWithLocationCount}</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-neutral-600\">Alerts today</span>\n                  <span className=\"font-bold text-neutral-800\">0</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Map Area */}\n        <div className=\"lg:col-span-3\">\n          <Tabs value={activeTab} onChange={setActiveTab}>\n            <TabList className=\"mb-4\">\n              <TabTrigger value=\"map\">Live Map</TabTrigger>\n              <TabTrigger value=\"alerts\">Alerts</TabTrigger>\n            </TabList>\n\n            <TabContent value=\"map\">\n              {/* Map container with gradient border */}\n              <div className=\"relative p-[2px] rounded-2xl bg-gradient-to-br from-primary-400 via-secondary-400 to-accent-400\">\n                <Card variant=\"default\" padding=\"none\" className=\"h-[600px] rounded-2xl overflow-hidden\">\n                  <FamilyMap\n                    members={familyMembersWithLocation.map(m => ({\n                      id: m.id,\n                      name: m.name,\n                      photoUrl: m.photoUrl,\n                      status: m.status,\n                      location: m.location,\n                      isSelected: selectedMember === m.id,\n                    }))}\n                    selectedMemberId={selectedMember}\n                    onMemberSelect={setSelectedMember}\n                    className=\"w-full h-full\"\n                  />\n                </Card>\n              </div>\n            </TabContent>\n\n            <TabContent value=\"alerts\">\n              <Card padding=\"lg\" className=\"hover-lift\">\n                <div className=\"text-center py-16\">\n                  <div className=\"w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center\">\n                    <BellIcon className=\"w-10 h-10 text-primary-500\" />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-neutral-800 mb-3\">No alerts</h3>\n                  <p className=\"text-neutral-500 max-w-sm mx-auto\">\n                    All your family members are in safe zones.\n                    You will receive notifications when someone enters or leaves a configured zone.\n                  </p>\n                </div>\n              </Card>\n            </TabContent>\n          </Tabs>\n        </div>\n      </div>\n\n      {/* Location Permission Modal */}\n      <LocationPermissionModal\n        isOpen={showPermissionModal}\n        onClose={() => setShowPermissionModal(false)}\n        onEnable={enableLocationSharing}\n        onSkip={() => setShowPermissionModal(false)}\n      />\n    </Container>\n  );\n}\n\nfunction formatLastSeen(timestamp: string): string {\n  const diff = Date.now() - new Date(timestamp).getTime();\n  const minutes = Math.floor(diff / 60000);\n\n  if (minutes < 1) return 'Just now';\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) return `${hours}h ago`;\n  return `${Math.floor(hours / 24)}d ago`;\n}\n\nfunction BatteryIndicator({ level }: { level: number }) {\n  const gradientClass = level > 50\n    ? 'from-green-400 to-emerald-500'\n    : level > 20\n      ? 'from-amber-400 to-orange-500'\n      : 'from-red-400 to-rose-500';\n\n  return (\n    <div className=\"flex items-center gap-1.5\">\n      <div className=\"relative w-5 h-3\">\n        <div className=\"absolute inset-0 rounded-sm border border-neutral-300 overflow-hidden\">\n          <div\n            className={`h-full bg-gradient-to-r ${gradientClass} transition-all`}\n            style={{ width: `${level}%` }}\n          />\n        </div>\n        <div className=\"absolute -right-0.5 top-1/2 -translate-y-1/2 w-0.5 h-1.5 bg-neutral-300 rounded-r-full\" />\n      </div>\n      <span className=\"text-xs font-medium text-neutral-600\">{level}%</span>\n    </div>\n  );\n}\n\n// Icons\nfunction LocationIcon() {\n  return (\n    <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z\" />\n      <circle cx=\"12\" cy=\"10\" r=\"3\" />\n    </svg>\n  );\n}\n\nfunction ZoneIcon() {\n  return (\n    <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <polygon points=\"12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2\" />\n      <path d=\"M12 22V15.5M22 8.5L12 15.5 2 8.5\" />\n    </svg>\n  );\n}\n\nfunction HistoryIcon() {\n  return (\n    <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      <path d=\"M12 6v6l4 2\" />\n    </svg>\n  );\n}\n\nfunction BellIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className || 'w-4 h-4'} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n      <path d=\"M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0\" />\n    </svg>\n  );\n}\n\nfunction CheckIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className || 'w-4 h-4'} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M20 6L9 17l-5-5\" />\n    </svg>\n  );\n}\n\nfunction UsersIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className || 'w-4 h-4'} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n      <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n      <circle cx=\"9\" cy=\"7\" r=\"4\" />\n      <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n    </svg>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}