{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/lib/supabase-server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\n\n// Lazy getter for environment variables\nfunction getEnvVars() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    return {\n      url: 'https://placeholder.supabase.co',\n      key: 'placeholder-anon-key-for-build-time-only',\n    };\n  }\n\n  return { url: supabaseUrl, key: supabaseAnonKey };\n}\n\n/**\n * Create a Supabase client for server components\n */\nexport async function createServerSupabaseClient() {\n  const cookieStore = await cookies();\n  const { url, key } = getEnvVars();\n\n  return createServerClient(url, key, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll();\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) =>\n            cookieStore.set(name, value, options)\n          );\n        } catch {\n          // The `setAll` method was called from a Server Component.\n          // This can be ignored if you have middleware refreshing sessions.\n        }\n      },\n    },\n  });\n}\n\n/**\n * Get the current user session from server\n */\nexport async function getServerSession() {\n  const supabase = await createServerSupabaseClient();\n  const { data: { session }, error } = await supabase.auth.getSession();\n  return { session, error };\n}\n\n/**\n * Get the current user from server\n */\nexport async function getServerUser() {\n  const supabase = await createServerSupabaseClient();\n  const { data: { user }, error } = await supabase.auth.getUser();\n  return { user, error };\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;;;AAEA,wCAAwC;AACxC,SAAS;IACP,MAAM;IACN,MAAM;IAEN;;IAOA,OAAO;QAAE,KAAK;QAAa,KAAK;IAAgB;AAClD;AAKO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG;IAErB,OAAO,IAAA,iMAAkB,EAAC,KAAK,KAAK;QAClC,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;IACF;AACF;AAKO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IACnE,OAAO;QAAE;QAAS;IAAM;AAC1B;AAKO,eAAe;IACpB,MAAM,WAAW,MAAM;IACvB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAC7D,OAAO;QAAE;QAAM;IAAM;AACvB"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///Users/smsm/Desktop/Portafolio%20IA/arbol-genealogico-digital%202/apps/web/src/app/auth/callback/route.ts"],"sourcesContent":["import { createServerSupabaseClient } from '@/lib/supabase-server';\nimport { NextResponse } from 'next/server';\n\nexport async function GET(request: Request) {\n  const requestUrl = new URL(request.url);\n  const code = requestUrl.searchParams.get('code');\n  const next = requestUrl.searchParams.get('next') ?? '/';\n\n  if (code) {\n    const supabase = await createServerSupabaseClient();\n    const { data, error } = await supabase.auth.exchangeCodeForSession(code);\n\n    if (!error && data?.user) {\n      const user = data.user;\n\n      // For OAuth users (Google), ensure user_profile exists\n      // The database trigger should handle this, but we check just in case\n      const { data: existingProfile } = await supabase\n        .from('user_profiles')\n        .select('id')\n        .eq('id', user.id)\n        .single();\n\n      if (!existingProfile) {\n        // Extract name from user metadata (Google provides full_name, name, or given_name/family_name)\n        const metadata = user.user_metadata || {};\n        const fullName = metadata.full_name || metadata.name || '';\n        const nameParts = fullName.split(' ');\n        const firstName = metadata.given_name || metadata.first_name || nameParts[0] || '';\n        const lastName = metadata.family_name || metadata.last_name || nameParts.slice(1).join(' ') || '';\n\n        // Create user profile for OAuth user\n        await supabase.from('user_profiles').insert({\n          id: user.id,\n          email: user.email,\n          first_name: firstName,\n          last_name: lastName,\n          avatar_url: metadata.avatar_url || metadata.picture,\n        });\n      }\n\n      // Successful authentication\n      return NextResponse.redirect(new URL(next, requestUrl.origin));\n    }\n  }\n\n  // Return to login on error\n  return NextResponse.redirect(new URL('/login?error=auth', requestUrl.origin));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,aAAa,IAAI,IAAI,QAAQ,GAAG;IACtC,MAAM,OAAO,WAAW,YAAY,CAAC,GAAG,CAAC;IACzC,MAAM,OAAO,WAAW,YAAY,CAAC,GAAG,CAAC,WAAW;IAEpD,IAAI,MAAM;QACR,MAAM,WAAW,MAAM,IAAA,+KAA0B;QACjD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,sBAAsB,CAAC;QAEnE,IAAI,CAAC,SAAS,MAAM,MAAM;YACxB,MAAM,OAAO,KAAK,IAAI;YAEtB,uDAAuD;YACvD,qEAAqE;YACrE,MAAM,EAAE,MAAM,eAAe,EAAE,GAAG,MAAM,SACrC,IAAI,CAAC,iBACL,MAAM,CAAC,MACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;YAET,IAAI,CAAC,iBAAiB;gBACpB,+FAA+F;gBAC/F,MAAM,WAAW,KAAK,aAAa,IAAI,CAAC;gBACxC,MAAM,WAAW,SAAS,SAAS,IAAI,SAAS,IAAI,IAAI;gBACxD,MAAM,YAAY,SAAS,KAAK,CAAC;gBACjC,MAAM,YAAY,SAAS,UAAU,IAAI,SAAS,UAAU,IAAI,SAAS,CAAC,EAAE,IAAI;gBAChF,MAAM,WAAW,SAAS,WAAW,IAAI,SAAS,SAAS,IAAI,UAAU,KAAK,CAAC,GAAG,IAAI,CAAC,QAAQ;gBAE/F,qCAAqC;gBACrC,MAAM,SAAS,IAAI,CAAC,iBAAiB,MAAM,CAAC;oBAC1C,IAAI,KAAK,EAAE;oBACX,OAAO,KAAK,KAAK;oBACjB,YAAY;oBACZ,WAAW;oBACX,YAAY,SAAS,UAAU,IAAI,SAAS,OAAO;gBACrD;YACF;YAEA,4BAA4B;YAC5B,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,MAAM,WAAW,MAAM;QAC9D;IACF;IAEA,2BAA2B;IAC3B,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,qBAAqB,WAAW,MAAM;AAC7E"}}]
}