{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/web/src/middleware.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { NextResponse, type NextRequest } from 'next/server';\n\n// Routes that require authentication\nconst protectedRoutes = ['/', '/tree', '/security', '/social', '/dyk', '/settings'];\n\n// Routes that should redirect to dashboard if authenticated\nconst authRoutes = ['/login', '/register'];\n\n// Get environment variables with fallback for build time\nfunction getEnvVars() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    return {\n      url: 'https://placeholder.supabase.co',\n      key: 'placeholder-anon-key-for-build-time-only',\n      isPlaceholder: true,\n    };\n  }\n\n  return { url: supabaseUrl, key: supabaseAnonKey, isPlaceholder: false };\n}\n\nexport async function middleware(request: NextRequest) {\n  const { url, key, isPlaceholder } = getEnvVars();\n\n  // Skip auth checks during build time with placeholder values\n  if (isPlaceholder) {\n    return NextResponse.next();\n  }\n\n  let response = NextResponse.next({\n    request: {\n      headers: request.headers,\n    },\n  });\n\n  const supabase = createServerClient(url, key, {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) =>\n            request.cookies.set(name, value)\n          );\n          response = NextResponse.next({\n            request: {\n              headers: request.headers,\n            },\n          });\n          cookiesToSet.forEach(({ name, value, options }) =>\n            response.cookies.set(name, value, options)\n          );\n        },\n      },\n    }\n  );\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  const pathname = request.nextUrl.pathname;\n\n  // Check if trying to access auth routes while authenticated\n  if (user && authRoutes.some((route) => pathname.startsWith(route))) {\n    return NextResponse.redirect(new URL('/', request.url));\n  }\n\n  // Check if trying to access protected routes without authentication\n  if (!user && protectedRoutes.some((route) => {\n    if (route === '/') return pathname === '/';\n    return pathname.startsWith(route);\n  })) {\n    const redirectUrl = new URL('/login', request.url);\n    redirectUrl.searchParams.set('redirect', pathname);\n    return NextResponse.redirect(redirectUrl);\n  }\n\n  return response;\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public files (images, etc)\n     * - api routes (handled separately)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$|api).*)',\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEA,qCAAqC;AACrC,MAAM,kBAAkB;IAAC;IAAK;IAAS;IAAa;IAAW;IAAQ;CAAY;AAEnF,4DAA4D;AAC5D,MAAM,aAAa;IAAC;IAAU;CAAY;AAE1C,yDAAyD;AACzD,SAAS;IACP,MAAM;IACN,MAAM;IAEN;;IAQA,OAAO;QAAE,KAAK;QAAa,KAAK;QAAiB,eAAe;IAAM;AACxE;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,aAAa,EAAE,GAAG;IAEpC,6DAA6D;IAC7D,IAAI,eAAe;QACjB,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,IAAI,WAAW,gMAAY,CAAC,IAAI,CAAC;QAC/B,SAAS;YACP,SAAS,QAAQ,OAAO;QAC1B;IACF;IAEA,MAAM,WAAW,IAAA,uMAAkB,EAAC,KAAK,KAAK;QAC1C,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GACnC,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAE5B,WAAW,gMAAY,CAAC,IAAI,CAAC;oBAC3B,SAAS;wBACP,SAAS,QAAQ,OAAO;oBAC1B;gBACF;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAEtC;QACF;IACF;IAGF,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,WAAW,QAAQ,OAAO,CAAC,QAAQ;IAEzC,4DAA4D;IAC5D,IAAI,QAAQ,WAAW,IAAI,CAAC,CAAC,QAAU,SAAS,UAAU,CAAC,SAAS;QAClE,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;IACvD;IAEA,oEAAoE;IACpE,IAAI,CAAC,QAAQ,gBAAgB,IAAI,CAAC,CAAC;QACjC,IAAI,UAAU,KAAK,OAAO,aAAa;QACvC,OAAO,SAAS,UAAU,CAAC;IAC7B,IAAI;QACF,MAAM,cAAc,IAAI,IAAI,UAAU,QAAQ,GAAG;QACjD,YAAY,YAAY,CAAC,GAAG,CAAC,YAAY;QACzC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;;KAOC,GACD;KACD;AACH"}}]
}